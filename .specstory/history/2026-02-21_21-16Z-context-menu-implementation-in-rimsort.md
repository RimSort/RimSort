<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 8bb23609-4544-472d-a209-6acc7e94dfb4 (2026-02-21 21:16Z) -->

# Context menu implementation in RimSort (2026-02-21 21:16Z)

_**User**_

In the RimSort codebase at d:\DEV_Rimsort\RimSort, find and return the full context menu implementation for the active mod list. Look in `app/views/mods_panel.py` for context menu creation and handling. I need to see:

1. How the right-click context menu is built (search for `context_menu`, `contextMenuEvent`, `customContextMenuRequested`, `addAction`)
2. What actions are currently available in the context menu
3. The signal connections for those actions

Return the relevant code sections with line numbers.

---

_**Agent (model composer-1, mode Agent)**_



---



---


Searching for the context menu implementation in the active mod list. Examining `app/views/mods_panel.py` and searching for context menu-related code.


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: d:\DEV_Rimsort\RimSort\app\views\mods_panel.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "context_menu|contextMenuEvent|customContextMenuRequested|addAction",
  "path": "d:\\DEV_Rimsort\\RimSort\\app\\views\\mods_panel.py",
  "caseInsensitive": true
}
```
Additional data:

```json
{
  "isPruned": true,
  "pattern": "context_menu|contextMenuEvent|customContextMenuRequested|addAction",
  "path": "d:\\DEV_Rimsort\\RimSort\\app\\views\\mods_panel.py",
  "outputMode": "content",
  "totalFiles": 1,
  "totalMatches": 26,
  "topFiles": [
    {
      "uri": "app\\views\\mods_panel.py",
      "matchCount": 26
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


Reading the relevant sections to get the full context menu implementation:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: d:\DEV_Rimsort\RimSort\app\views\mods_panel.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "def.*context|customContextMenuRequested|contextMenuEvent",
  "path": "d:\\DEV_Rimsort\\RimSort\\app\\views\\mods_panel.py",
  "caseInsensitive": true
}
```
Additional data:

```json
{
  "isPruned": true,
  "pattern": "def.*context|customContextMenuRequested|contextMenuEvent",
  "path": "d:\\DEV_Rimsort\\RimSort\\app\\views\\mods_panel.py",
  "outputMode": "content",
  "totalFiles": 0,
  "totalMatches": 0,
  "topFiles": []
}
```
Status: **completed**


</details>
</tool-use>

---



---


Reading further to find signal connections for the actions:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: d:\DEV_Rimsort\RimSort\app\views\mods_panel.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "\\.triggered\\.connect|\\.clicked\\.connect|\\.activated\\.connect",
  "path": "d:\\DEV_Rimsort\\RimSort\\app\\views\\mods_panel.py",
  "caseInsensitive": false
}
```
Additional data:

```json
{
  "isPruned": true,
  "pattern": "\\.triggered\\.connect|\\.clicked\\.connect|\\.activated\\.connect",
  "path": "d:\\DEV_Rimsort\\RimSort\\app\\views\\mods_panel.py",
  "outputMode": "content",
  "totalFiles": 1,
  "totalMatches": 15,
  "topFiles": [
    {
      "uri": "app\\views\\mods_panel.py",
      "matchCount": 15
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


Reading the rest of the action handlers:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: d:\DEV_Rimsort\RimSort\app\views\mods_panel.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "deletion_sub_menu",
  "path": "d:\\DEV_Rimsort\\RimSort\\app\\views\\mods_panel.py",
  "caseInsensitive": false
}
```
Additional data:

```json
{
  "isPruned": true,
  "pattern": "deletion_sub_menu",
  "path": "d:\\DEV_Rimsort\\RimSort\\app\\views\\mods_panel.py",
  "outputMode": "content",
  "totalFiles": 1,
  "totalMatches": 3,
  "topFiles": [
    {
      "uri": "app\\views\\mods_panel.py",
      "matchCount": 3
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


Checking the deletion submenu implementation:


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "class ModDeletionMenu|def __init__.*ModDeletionMenu",
  "path": "d:\\DEV_Rimsort\\RimSort\\app\\views\\mods_panel.py",
  "caseInsensitive": false
}
```
Additional data:

```json
{
  "isPruned": true,
  "pattern": "class ModDeletionMenu|def __init__.*ModDeletionMenu",
  "path": "d:\\DEV_Rimsort\\RimSort\\app\\views\\mods_panel.py",
  "outputMode": "content",
  "totalFiles": 0,
  "totalMatches": 0,
  "topFiles": []
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "What is ModDeletionMenu and what actions does it contain?",
  "includePattern": "app/views",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 34,
            "column": 57
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {},
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Enhanced mod deletion menu with optimized operations and better error handling.\"\"\"",
            "lineNumber": 39
          },
          {
            "lineNumber": 40
          },
          {
            "text": "    # Constants for better maintainability",
            "lineNumber": 41
          },
          {
            "text": "    LUDEON_PACKAGE_PREFIX = \"ludeon.rimworld\"",
            "lineNumber": 42
          },
          {
            "text": "    EXPANSION_DATA_SOURCE = \"expansion\"",
            "lineNumber": 43
          },
          {
            "text": "    DDS_EXTENSION = \".dds\"",
            "lineNumber": 44
          },
          {
            "lineNumber": 45
          },
          {
            "text": "    # Logging level constants",
            "lineNumber": 46
          },
          {
            "text": "    LOG_LEVEL_DEBUG = \"DEBUG\"",
            "lineNumber": 47
          },
          {
            "text": "    LOG_LEVEL_INFO = \"INFO\"",
            "lineNumber": 48
          },
          {
            "text": "    LOG_LEVEL_WARNING = \"WARNING\"",
            "lineNumber": 49
          },
          {
            "text": "    LOG_LEVEL_ERROR = \"ERROR\"",
            "lineNumber": 50
          },
          {
            "lineNumber": 51
          },
          {
            "text": "    def __init__(",
            "lineNumber": 52
          },
          {
            "text": "        self,",
            "lineNumber": 53
          },
          {
            "text": "        settings_controller: SettingsController,",
            "lineNumber": 54
          },
          {
            "text": "        get_selected_mod_metadata: Callable[[], list[ModMetadata]],",
            "lineNumber": 55
          },
          {
            "text": "        remove_from_uuids: list[str] | None = None,",
            "lineNumber": 56
          },
          {
            "text": "        menu_title: str = \"Deletion options\",",
            "lineNumber": 57
          },
          {
            "text": "        enable_delete_mod: bool = True,",
            "lineNumber": 58
          },
          {
            "text": "        enable_delete_keep_dds: bool = True,",
            "lineNumber": 59
          },
          {
            "text": "        enable_delete_dds_only: bool = True,",
            "lineNumber": 60
          },
          {
            "text": "        enable_delete_and_unsubscribe: bool = True,",
            "lineNumber": 61
          },
          {
            "text": "        enable_delete_and_resubscribe: bool = True,",
            "lineNumber": 62
          },
          {
            "text": "        completion_callback: Callable[[], None] | None = None,",
            "lineNumber": 63
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 64
          },
          {
            "text": "        super().__init__(title=self.tr(\"Deletion options\"))",
            "lineNumber": 65
          },
          {
            "text": "        self.remove_from_uuids = remove_from_uuids",
            "lineNumber": 66
          },
          {
            "text": "        self.get_selected_mod_metadata = get_selected_mod_metadata",
            "lineNumber": 67
          },
          {
            "text": "        self.metadata_manager = MetadataManager.instance()",
            "lineNumber": 68
          },
          {
            "text": "        self.settings_controller = settings_controller",
            "lineNumber": 69
          },
          {
            "text": "        self.completion_callback = completion_callback",
            "lineNumber": 70
          },
          {
            "text": "        self._actions_initialized = False",
            "lineNumber": 71
          },
          {
            "lineNumber": 72
          },
          {
            "text": "        # Debug logging for remove_from_uuids",
            "lineNumber": 73
          },
          {
            "text": "        logger.debug(",
            "lineNumber": 74
          },
          {
            "text": "            f\"ModDeletionMenu initialized with remove_from_uuids: {self.remove_from_uuids}\"",
            "lineNumber": 75
          },
          {
            "text": "        )",
            "lineNumber": 76
          },
          {
            "lineNumber": 77
          },
          {
            "text": "        # Synchronize remove_from_uuids with selected mods' UUIDs",
            "lineNumber": 78
          },
          {
            "text": "        self._sync_remove_from_uuids_with_selected_mods()",
            "lineNumber": 79
          },
          {
            "lineNumber": 80
          },
          {
            "text": "        # Build actions based on enabled features",
            "lineNumber": 81
          },
          {
            "text": "        self.delete_actions: list[tuple[QAction, Callable[[], None]]] = []",
            "lineNumber": 82
          },
          {
            "text": "        self._build_actions(",
            "lineNumber": 83
          },
          {
            "text": "            enable_delete_mod,",
            "lineNumber": 84
          },
          {
            "text": "            enable_delete_keep_dds,",
            "lineNumber": 85
          },
          {
            "text": "            enable_delete_dds_only,",
            "lineNumber": 86
          },
          {
            "text": "            enable_delete_and_unsubscribe,",
            "lineNumber": 87
          },
          {
            "text": "            enable_delete_and_resubscribe,",
            "lineNumber": 88
          },
          {
            "text": "        )",
            "lineNumber": 89
          },
          {
            "lineNumber": 90
          },
          {
            "text": "        self.aboutToShow.connect(self._refresh_actions)",
            "lineNumber": 91
          },
          {
            "text": "        self._refresh_actions()",
            "lineNumber": 92
          },
          {
            "lineNumber": 93
          },
          {
            "text": "    def _sync_remove_from_uuids_with_selected_mods(self) -&gt; None:",
            "lineNumber": 94
          },
          {
            "text": "        ",
            "lineNumber": 95
          }
        ]
      },
      "score": 0.6078048944473267
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "text": "def _sync_remove_from_uuids_with_selected_mods(self) -&gt; None:",
            "lineNumber": 94
          },
          {
            "text": "{self.remove_from_uuids}\")",
            "lineNumber": 112
          },
          {
            "lineNumber": 113
          },
          {
            "text": "    def _build_actions(",
            "lineNumber": 114
          },
          {
            "text": "        self,",
            "lineNumber": 115
          },
          {
            "text": "        enable_delete_mod: bool,",
            "lineNumber": 116
          },
          {
            "text": "        enable_delete_keep_dds: bool,",
            "lineNumber": 117
          },
          {
            "text": "        enable_delete_dds_only: bool,",
            "lineNumber": 118
          },
          {
            "text": "        enable_delete_and_unsubscribe: bool,",
            "lineNumber": 119
          },
          {
            "text": "        enable_delete_and_resubscribe: bool,",
            "lineNumber": 120
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 121
          },
          {
            "text": "        \"\"\"Build the list of available deletion actions.\"\"\"",
            "lineNumber": 122
          },
          {
            "text": "        if enable_delete_mod:",
            "lineNumber": 123
          },
          {
            "text": "            self.delete_actions.append(",
            "lineNumber": 124
          },
          {
            "text": "                (QAction(self.tr(\"Delete mod completely\")), self.delete_mod_completely)",
            "lineNumber": 125
          },
          {
            "text": "            )",
            "lineNumber": 126
          },
          {
            "lineNumber": 127
          },
          {
            "text": "        if enable_delete_keep_dds:",
            "lineNumber": 128
          },
          {
            "text": "            self.delete_actions.append(",
            "lineNumber": 129
          },
          {
            "text": "                (",
            "lineNumber": 130
          },
          {
            "text": "                    QAction(self.tr(\"Delete mod (keep .dds textures)\")),",
            "lineNumber": 131
          },
          {
            "text": "                    self.delete_mod_keep_dds,",
            "lineNumber": 132
          },
          {
            "text": "                )",
            "lineNumber": 133
          },
          {
            "text": "            )",
            "lineNumber": 134
          },
          {
            "lineNumber": 135
          },
          {
            "text": "        if enable_delete_dds_only:",
            "lineNumber": 136
          },
          {
            "text": "            self.delete_actions.append(",
            "lineNumber": 137
          },
          {
            "text": "                (",
            "lineNumber": 138
          },
          {
            "text": "                    QAction(self.tr(\"Delete optimized textures (.dds files only)\")),",
            "lineNumber": 139
          },
          {
            "text": "                    self.delete_dds_files_only,",
            "lineNumber": 140
          },
          {
            "text": "                )",
            "lineNumber": 141
          },
          {
            "text": "            )",
            "lineNumber": 142
          },
          {
            "lineNumber": 143
          },
          {
            "text": "        if enable_delete_and_unsubscribe:",
            "lineNumber": 144
          },
          {
            "text": "            self.delete_actions.append(",
            "lineNumber": 145
          },
          {
            "text": "                (",
            "lineNumber": 146
          },
          {
            "text": "                    QAction(self.tr(\"Delete mod and unsubscribe from Steam\")),",
            "lineNumber": 147
          },
          {
            "text": "                    self.delete_mod_and_unsubscribe,",
            "lineNumber": 148
          },
          {
            "text": "                )",
            "lineNumber": 149
          },
          {
            "text": "            )",
            "lineNumber": 150
          },
          {
            "lineNumber": 151
          },
          {
            "text": "        # Add new action for delete mod and resubscribe",
            "lineNumber": 152
          },
          {
            "text": "        if enable_delete_and_resubscribe:",
            "lineNumber": 153
          },
          {
            "text": "            self.delete_actions.append(",
            "lineNumber": 154
          },
          {
            "text": "                (",
            "lineNumber": 155
          },
          {
            "text": "                    QAction(self.tr(\"Delete mod and resubscribe using Steam\")),",
            "lineNumber": 156
          },
          {
            "text": "                    self.delete_mod_and_resubscribe,",
            "lineNumber": 157
          },
          {
            "text": "                )",
            "lineNumber": 158
          },
          {
            "text": "            )",
            "lineNumber": 159
          },
          {
            "lineNumber": 160
          },
          {
            "text": "    def _has_steam_mods(self) -&gt; bool:",
            "lineNumber": 161
          },
          {
            "text": "        \"\"\"Check if any selected mods are Steam Workshop mods.\"\"\"",
            "lineNumber": 162
          },
          {
            "text": "        selected_mods = self.get_selected_mod_metadata()",
            "lineNumber": 163
          },
          {
            "text": "        return any(mod.get(\"publishedfileid\") for mod in selected_mods)",
            "lineNumber": 164
          },
          {
            "lineNumber": 165
          },
          {
            "text": "    def _has_dds_files(self) -&gt; bool:",
            "lineNumber": 166
          },
          {
            "text": "        \"\"\"Check if any selected mods contain .dds files.\"\"\"",
            "lineNumber": 167
          }
        ]
      },
      "score": 0.5193354487419128
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 164
          },
          {
            "lineNumber": 165
          },
          {
            "text": "    def _has_dds_files(self) -&gt; bool:",
            "lineNumber": 166
          },
          {
            "text": "        \"\"\"Check if any selected mods contain .dds files.\"\"\"",
            "lineNumber": 167
          },
          {
            "text": "        selected_mods = self.get_selected_mod_metadata()",
            "lineNumber": 168
          },
          {
            "text": "        for mod in selected_mods:",
            "lineNumber": 169
          },
          {
            "text": "            mod_path = mod.get(\"path\")",
            "lineNumber": 170
          },
          {
            "text": "            if mod_path:",
            "lineNumber": 171
          },
          {
            "text": "                try:",
            "lineNumber": 172
          },
          {
            "text": "                    for root, dirs, files in os.walk(mod_path):",
            "lineNumber": 173
          },
          {
            "text": "                        if any(file.endswith(self.DDS_EXTENSION) for file in files):",
            "lineNumber": 174
          },
          {
            "text": "                            return True",
            "lineNumber": 175
          },
          {
            "text": "                        # Limit depth to avoid performance issues",
            "lineNumber": 176
          },
          {
            "text": "                        if root != mod_path:",
            "lineNumber": 177
          },
          {
            "text": "                            break",
            "lineNumber": 178
          },
          {
            "text": "                except (OSError, PermissionError):",
            "lineNumber": 179
          },
          {
            "text": "                    continue",
            "lineNumber": 180
          },
          {
            "text": "        return False",
            "lineNumber": 181
          },
          {
            "lineNumber": 182
          },
          {
            "text": "    def _refresh_actions(self) -&gt; None:",
            "lineNumber": 183
          },
          {
            "text": "        \"\"\"Refresh menu actions, optimized to avoid unnecessary reconnections.\"\"\"",
            "lineNumber": 184
          },
          {
            "text": "        if not self._actions_initialized:",
            "lineNumber": 185
          },
          {
            "text": "            self.clear()",
            "lineNumber": 186
          },
          {
            "text": "            for q_action, fn in self.delete_actions:",
            "lineNumber": 187
          },
          {
            "text": "                q_action.triggered.connect(fn)",
            "lineNumber": 188
          },
          {
            "text": "                self.addAction(q_action)",
            "lineNumber": 189
          },
          {
            "text": "            self._actions_initialized = True",
            "lineNumber": 190
          },
          {
            "lineNumber": 191
          },
          {
            "text": "        # Conditionally enable actions based on selected mods",
            "lineNumber": 192
          },
          {
            "text": "        for q_action, fn in self.delete_actions:",
            "lineNumber": 193
          },
          {
            "text": "            if fn == self.delete_dds_files_only:",
            "lineNumber": 194
          },
          {
            "text": "                q_action.setEnabled(self._has_dds_files())",
            "lineNumber": 195
          },
          {
            "text": "            elif fn in (",
            "lineNumber": 196
          },
          {
            "text": "                self.delete_mod_and_unsubscribe,",
            "lineNumber": 197
          },
          {
            "text": "                self.delete_mod_and_resubscribe,",
            "lineNumber": 198
          },
          {
            "text": "            ):",
            "lineNumber": 199
          },
          {
            "text": "                q_action.setEnabled(self._has_steam_mods())",
            "lineNumber": 200
          },
          {
            "text": "            else:",
            "lineNumber": 201
          },
          {
            "text": "                q_action.setEnabled(True)",
            "lineNumber": 202
          },
          {
            "lineNumber": 203
          },
          {
            "text": "    def _confirm_deletion(self, title: str, text: str, information: str) -&gt; bool:",
            "lineNumber": 204
          },
          {
            "text": "        \"\"\"Helper method to show deletion confirmation dialog.\"\"\"",
            "lineNumber": 205
          },
          {
            "text": "        answer = show_dialogue_conditional(",
            "lineNumber": 206
          },
          {
            "text": "            title=title,",
            "lineNumber": 207
          },
          {
            "text": "            text=text,",
            "lineNumber": 208
          },
          {
            "text": "            information=information,",
            "lineNumber": 209
          },
          {
            "text": "        )",
            "lineNumber": 210
          },
          {
            "text": "        return answer == QMessageBox.StandardButton.Yes",
            "lineNumber": 211
          },
          {
            "lineNumber": 212
          },
          {
            "text": "    def _get_selected_mod_count(self) -&gt; int:",
            "lineNumber": 213
          },
          {
            "text": "        \"\"\"Get the count of currently selected mods.\"\"\"",
            "lineNumber": 214
          }
        ]
      },
      "score": 0.49228793382644653
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 304
          },
          {
            "lineNumber": 305
          },
          {
            "text": "    def _iterate_mods(",
            "lineNumber": 306
          },
          {
            "text": "        self,",
            "lineNumber": 307
          },
          {
            "text": "        deletion_fn: Callable[[ModMetadata], bool],",
            "lineNumber": 308
          },
          {
            "text": "        mods: list[ModMetadata],",
            "lineNumber": 309
          },
          {
            "text": "        collect_for_unsubscribe: bool = False,",
            "lineNumber": 310
          },
          {
            "text": "        update_db: bool = True,",
            "lineNumber": 311
          },
          {
            "text": "        show_progress: bool = False,",
            "lineNumber": 312
          },
          {
            "text": "    ) -&gt; DeletionResult:",
            "lineNumber": 313
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 314
          },
          {
            "text": "        Iterate through mods and apply the deletion function with improved error handling and optional progress tracking.",
            "lineNumber": 315
          },
          {
            "lineNumber": 316
          },
          {
            "text": "        Args:",
            "lineNumber": 317
          },
          {
            "text": "            deletion_fn: Function to apply to each mod",
            "lineNumber": 318
          },
          {
            "text": "            mods: List of mod metadata to process",
            "lineNumber": 319
          },
          {
            "text": "            collect_for_unsubscribe: Whether to collect successfully deleted mods for unsubscription",
            "lineNumber": 320
          },
          {
            "text": "            update_db: Whether to update the auxiliary database",
            "lineNumber": 321
          },
          {
            "text": "            show_progress: Whether to show progress indicators during operation",
            "lineNumber": 322
          },
          {
            "lineNumber": 323
          },
          {
            "text": "        Returns:",
            "lineNumber": 324
          },
          {
            "text": "            DeletionResult containing operation statistics",
            "lineNumber": 325
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 326
          },
          {
            "text": "        result = DeletionResult()",
            "lineNumber": 327
          },
          {
            "text": "        total_mods = len(mods)",
            "lineNumber": 328
          },
          {
            "text": "        processed_count = 0",
            "lineNumber": 329
          },
          {
            "lineNumber": 330
          },
          {
            "text": "        for mod_metadata in mods:",
            "lineNumber": 331
          },
          {
            "text": "            processed_count += 1",
            "lineNumber": 332
          },
          {
            "lineNumber": 333
          },
          {
            "text": "            # Skip official expansions",
            "lineNumber": 334
          },
          {
            "text": "            if self._is_official_expansion(mod_metadata):",
            "lineNumber": 335
          },
          {
            "text": "                logger.info(",
            "lineNumber": 336
          },
          {
            "text": "                    f\"Skipping official expansion: {mod_metadata.get('name', 'Unknown')}\"",
            "lineNumber": 337
          },
          {
            "text": "                )",
            "lineNumber": 338
          },
          {
            "text": "                self._log_progress_if_enabled(",
            "lineNumber": 339
          },
          {
            "text": "                    processed_count, total_mods, show_progress",
            "lineNumber": 340
          },
          {
            "text": "                )",
            "lineNumber": 341
          },
          {
            "text": "                continue",
            "lineNumber": 342
          },
          {
            "lineNumber": 343
          },
          {
            "text": "            # Process the mod deletion",
            "lineNumber": 344
          },
          {
            "text": "            if self._process_single_mod_deletion(",
            "lineNumber": 345
          },
          {
            "text": "                mod_metadata, deletion_fn, result, collect_for_unsubscribe, update_db",
            "lineNumber": 346
          },
          {
            "text": "            ):",
            "lineNumber": 347
          },
          {
            "text": "                # Handle successful deletion tasks",
            "lineNumber": 348
          },
          {
            "text": "                self._handle_successful_deletion(",
            "lineNumber": 349
          },
          {
            "text": "                    mod_metadata, result, collect_for_unsubscribe",
            "lineNumber": 350
          },
          {
            "text": "                )",
            "lineNumber": 351
          },
          {
            "lineNumber": 352
          },
          {
            "text": "            self._log_progress_if_enabled(processed_count, total_mods, show_progress)",
            "lineNumber": 353
          },
          {
            "lineNumber": 354
          },
          {
            "text": "        self._log_deletion_summary(result)",
            "lineNumber": 355
          },
          {
            "text": "        return result",
            "lineNumber": 356
          },
          {
            "lineNumber": 357
          },
          {
            "text": "    def _process_single_mod_deletion(",
            "lineNumber": 358
          },
          {
            "text": "        self,",
            "lineNumber": 359
          },
          {
            "text": "        mod_metadata: ModMetadata,",
            "lineNumber": 360
          },
          {
            "text": "        deletion_fn: Callable[[ModMetadata], bool],",
            "lineNumber": 361
          },
          {
            "text": "        result: DeletionResult,",
            "lineNumber": 362
          },
          {
            "text": "        collect_for_unsubscribe: bool,",
            "lineNumber": 363
          },
          {
            "text": "        update_db: bool,",
            "lineNumber": 364
          },
          {
            "text": "    ) -&gt; bool:",
            "lineNumber": 365
          },
          {
            "text": "        ",
            "lineNumber": 366
          }
        ]
      },
      "score": 0.4607773423194885
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {},
        "detailedLines": [
          {
            "text": "import errno",
            "lineNumber": 1
          },
          {
            "text": "import os",
            "lineNumber": 2
          },
          {
            "text": "from pathlib import Path",
            "lineNumber": 3
          },
          {
            "text": "from shutil import rmtree",
            "lineNumber": 4
          },
          {
            "text": "from typing import Callable",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "from loguru import logger",
            "lineNumber": 7
          },
          {
            "text": "from PySide6.QtGui import QAction",
            "lineNumber": 8
          },
          {
            "text": "from PySide6.QtWidgets import QMenu, QMessageBox",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "from app.controllers.metadata_db_controller import AuxMetadataController",
            "lineNumber": 11
          },
          {
            "text": "from app.controllers.settings_controller import SettingsController",
            "lineNumber": 12
          },
          {
            "text": "from app.utils.acf_utils import steamcmd_purge_mods",
            "lineNumber": 13
          },
          {
            "text": "from app.utils.event_bus import EventBus",
            "lineNumber": 14
          },
          {
            "text": "from app.utils.generic import (",
            "lineNumber": 15
          },
          {
            "text": "    attempt_chmod,",
            "lineNumber": 16
          },
          {
            "text": "    delete_files_except_extension,",
            "lineNumber": 17
          },
          {
            "text": "    delete_files_only_extension,",
            "lineNumber": 18
          },
          {
            "text": ")",
            "lineNumber": 19
          },
          {
            "text": "from app.utils.metadata import MetadataManager, ModMetadata",
            "lineNumber": 20
          },
          {
            "text": "from app.views.dialogue import (",
            "lineNumber": 21
          },
          {
            "text": "    show_dialogue_conditional,",
            "lineNumber": 22
          },
          {
            "text": "    show_information,",
            "lineNumber": 23
          },
          {
            "text": "    show_warning,",
            "lineNumber": 24
          },
          {
            "text": ")",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "class DeletionResult:",
            "lineNumber": 28,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Class to track deletion operation results.\"\"\"",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "    def __init__(self) -&gt; None:",
            "lineNumber": 31
          },
          {
            "text": "        self.success_count: int = 0",
            "lineNumber": 32
          },
          {
            "text": "        self.failed_count: int = 0",
            "lineNumber": 33
          },
          {
            "text": "        self.steamcmd_purge_ids: set[str] = set()",
            "lineNumber": 34
          },
          {
            "text": "        self.mods_for_unsubscribe: list[ModMetadata] = []",
            "lineNumber": 35,
            "isSignature": true
          },
          {
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "text": "    \"\"\"Enhanced mod deletion menu with optimized operations and better error handling.",
            "lineNumber": 39
          }
        ]
      },
      "score": 0.4551539421081543
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 211
          },
          {
            "lineNumber": 212
          },
          {
            "text": "    def _get_selected_mod_count(self) -&gt; int:",
            "lineNumber": 213
          },
          {
            "text": "        \"\"\"Get the count of currently selected mods.\"\"\"",
            "lineNumber": 214
          },
          {
            "text": "        return len(self.get_selected_mod_metadata())",
            "lineNumber": 215
          },
          {
            "lineNumber": 216
          },
          {
            "text": "    def _show_no_mods_selected_message(self) -&gt; None:",
            "lineNumber": 217
          },
          {
            "text": "        \"\"\"Show message when no mods are selected.\"\"\"",
            "lineNumber": 218
          },
          {
            "text": "        show_information(",
            "lineNumber": 219
          },
          {
            "text": "            title=self.tr(\"No mods selected\"),",
            "lineNumber": 220
          },
          {
            "text": "            text=self.tr(\"Please select at least one mod to process.\"),",
            "lineNumber": 221
          },
          {
            "text": "        )",
            "lineNumber": 222
          },
          {
            "lineNumber": 223
          },
          {
            "text": "    def _perform_deletion_operation(",
            "lineNumber": 224
          },
          {
            "text": "        self,",
            "lineNumber": 225
          },
          {
            "text": "        confirmation_title: str,",
            "lineNumber": 226
          },
          {
            "text": "        confirmation_text: str,",
            "lineNumber": 227
          },
          {
            "text": "        confirmation_info: str,",
            "lineNumber": 228
          },
          {
            "text": "        deletion_fn: Callable[[ModMetadata], bool],",
            "lineNumber": 229
          },
          {
            "text": "        update_db: bool = True,",
            "lineNumber": 230
          },
          {
            "text": "        show_progress: bool = False,",
            "lineNumber": 231
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 232
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 233
          },
          {
            "text": "        Generic method to perform a deletion operation with confirmation and optional progress tracking.",
            "lineNumber": 234
          },
          {
            "lineNumber": 235
          },
          {
            "text": "        Args:",
            "lineNumber": 236
          },
          {
            "text": "            confirmation_title: Title for the confirmation dialog",
            "lineNumber": 237
          },
          {
            "text": "            confirmation_text: Main text for the confirmation dialog",
            "lineNumber": 238
          },
          {
            "text": "            confirmation_info: Additional information for the confirmation dialog",
            "lineNumber": 239
          },
          {
            "text": "            deletion_fn: Function to apply to each mod for deletion",
            "lineNumber": 240
          },
          {
            "text": "            update_db: Whether to update the auxiliary database",
            "lineNumber": 241
          },
          {
            "text": "            show_progress: Whether to show progress indicators during operation",
            "lineNumber": 242
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 243
          },
          {
            "text": "        selected_mods = self.get_selected_mod_metadata()",
            "lineNumber": 244
          },
          {
            "lineNumber": 245
          },
          {
            "text": "        if not selected_mods:",
            "lineNumber": 246
          },
          {
            "text": "            self._show_no_mods_selected_message()",
            "lineNumber": 247
          },
          {
            "text": "            return",
            "lineNumber": 248
          },
          {
            "lineNumber": 249
          },
          {
            "text": "        # Synchronize remove_from_uuids with current selected mods before deletion",
            "lineNumber": 250
          },
          {
            "text": "        self._sync_remove_from_uuids_with_selected_mods()",
            "lineNumber": 251
          },
          {
            "lineNumber": 252
          },
          {
            "text": "        if self._confirm_deletion(",
            "lineNumber": 253
          },
          {
            "text": "            confirmation_title, confirmation_text, confirmation_info",
            "lineNumber": 254
          },
          {
            "text": "        ):",
            "lineNumber": 255
          },
          {
            "text": "            result = self._iterate_mods(",
            "lineNumber": 256
          },
          {
            "text": "                deletion_fn,",
            "lineNumber": 257
          },
          {
            "text": "                selected_mods,",
            "lineNumber": 258
          },
          {
            "text": "                update_db=update_db,",
            "lineNumber": 259
          },
          {
            "text": "                show_progress=show_progress,",
            "lineNumber": 260
          },
          {
            "text": "            )",
            "lineNumber": 261
          },
          {
            "text": "            self._process_deletion_result(result)",
            "lineNumber": 262
          },
          {
            "lineNumber": 263
          },
          {
            "text": "    def _is_official_expansion(self, mod_metadata: ModMetadata) -&gt; bool:",
            "lineNumber": 264
          },
          {
            "text": "        \"\"\"Check if the mod is an official expansion that should not be deleted.\"\"\"",
            "lineNumber": 265
          }
        ]
      },
      "score": 0.45368844270706177
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "text": "def _delete_mod_directory(self, mod_metadata: ModMetadata) -&gt; bool:",
            "lineNumber": 536
          },
          {
            "lineNumber": 581
          },
          {
            "text": "            )",
            "lineNumber": 582
          },
          {
            "text": "            return False",
            "lineNumber": 583
          },
          {
            "lineNumber": 584
          },
          {
            "text": "    def delete_mod_completely(self) -&gt; None:",
            "lineNumber": 585
          },
          {
            "text": "        \"\"\"Delete selected mods completely from the filesystem.\"\"\"",
            "lineNumber": 586
          },
          {
            "text": "        selected_count = len(self.get_selected_mod_metadata())",
            "lineNumber": 587
          },
          {
            "text": "        self._perform_deletion_operation(",
            "lineNumber": 588
          },
          {
            "text": "            confirmation_title=self.tr(\"Confirm Complete Deletion\"),",
            "lineNumber": 589
          },
          {
            "text": "            confirmation_text=self.tr(",
            "lineNumber": 590
          },
          {
            "text": "                f\"You have selected {selected_count} mod(s) for complete deletion.\"",
            "lineNumber": 591
          },
          {
            "text": "            ),",
            "lineNumber": 592
          },
          {
            "text": "            confirmation_info=self.tr(",
            "lineNumber": 593
          },
          {
            "text": "                \"\\nThis operation will permanently delete the selected mod directories from the filesystem.\\n\\nDo you want to proceed?\"",
            "lineNumber": 594
          },
          {
            "text": "            ),",
            "lineNumber": 595
          },
          {
            "text": "            deletion_fn=self._delete_mod_directory,",
            "lineNumber": 596
          },
          {
            "text": "        )",
            "lineNumber": 597
          },
          {
            "lineNumber": 598
          },
          {
            "text": "    def delete_dds_files_only(self) -&gt; None:",
            "lineNumber": 599
          },
          {
            "text": "        \"\"\"Delete only .dds texture files from selected mods.\"\"\"",
            "lineNumber": 600
          },
          {
            "text": "        selected_count = len(self.get_selected_mod_metadata())",
            "lineNumber": 601
          },
          {
            "text": "        self._perform_deletion_operation(",
            "lineNumber": 602
          },
          {
            "text": "            confirmation_title=self.tr(\"Confirm DDS Deletion\"),",
            "lineNumber": 603
          },
          {
            "text": "            confirmation_text=self.tr(",
            "lineNumber": 604
          },
          {
            "text": "                f\"You have selected {selected_count} mod(s) for DDS texture deletion.\"",
            "lineNumber": 605
          },
          {
            "text": "            ),",
            "lineNumber": 606
          },
          {
            "text": "            confirmation_info=self.tr(",
            "lineNumber": 607
          },
          {
            "text": "                \"\\nThis operation will only delete optimized textures (.dds files) from the selected mods.\\n\\nDo you want to proceed?\"",
            "lineNumber": 608
          },
          {
            "text": "            ),",
            "lineNumber": 609
          },
          {
            "text": "            deletion_fn=self._delete_dds_from_mod,",
            "lineNumber": 610
          },
          {
            "text": "            update_db=False,",
            "lineNumber": 611
          },
          {
            "text": "        )",
            "lineNumber": 612
          },
          {
            "lineNumber": 613
          },
          {
            "text": "    def _delete_dds_from_mod(self, mod_metadata: ModMetadata) -&gt; bool:",
            "lineNumber": 614
          },
          {
            "text": "        \"\"\"Delete .dds files from a specific mod.\"\"\"",
            "lineNumber": 615
          },
          {
            "text": "        mod_path = mod_metadata.get(\"path\")",
            "lineNumber": 616
          },
          {
            "text": "        if not mod_path:",
            "lineNumber": 617
          },
          {
            "text": "            return False",
            "lineNumber": 618
          },
          {
            "text": "        return delete_files_only_extension(",
            "lineNumber": 619
          },
          {
            "text": "            directory=str(mod_path),",
            "lineNumber": 620
          },
          {
            "text": "            extension=self.DDS_EXTENSION,",
            "lineNumber": 621
          },
          {
            "text": "        )",
            "lineNumber": 622
          },
          {
            "lineNumber": 623
          },
          {
            "text": "    def delete_mod_keep_dds(self) -&gt; None:",
            "lineNumber": 624
          },
          {
            "text": "        \"\"\"Delete mod files but keep .dds texture files.\"\"\"",
            "lineNumber": 625
          }
        ]
      },
      "score": 0.43396010994911194
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 534
          },
          {
            "lineNumber": 535
          },
          {
            "text": "    def _delete_mod_directory(self, mod_metadata: ModMetadata) -&gt; bool:",
            "lineNumber": 536
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 537
          },
          {
            "text": "        Common method to delete a mod's directory completely.",
            "lineNumber": 538
          },
          {
            "lineNumber": 539
          },
          {
            "text": "        Args:",
            "lineNumber": 540
          },
          {
            "text": "            mod_metadata: Metadata of the mod to delete",
            "lineNumber": 541
          },
          {
            "lineNumber": 542
          },
          {
            "text": "        Returns:",
            "lineNumber": 543
          },
          {
            "text": "            bool: True if deletion was successful, False otherwise",
            "lineNumber": 544
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 545
          },
          {
            "text": "        mod_path = mod_metadata.get(\"path\")",
            "lineNumber": 546
          },
          {
            "text": "        mod_name = mod_metadata.get(\"name\", \"Unknown\")",
            "lineNumber": 547
          },
          {
            "lineNumber": 548
          },
          {
            "text": "        if not mod_path:",
            "lineNumber": 549
          },
          {
            "text": "            logger.error(f\"No path found for mod: {mod_name}\")",
            "lineNumber": 550
          },
          {
            "text": "            return False",
            "lineNumber": 551
          },
          {
            "lineNumber": 552
          },
          {
            "text": "        try:",
            "lineNumber": 553
          },
          {
            "text": "            rmtree(mod_path, ignore_errors=False, onexc=attempt_chmod)",
            "lineNumber": 554
          },
          {
            "text": "            logger.info(f\"Successfully deleted mod directory: {mod_path}\")",
            "lineNumber": 555
          },
          {
            "text": "            return True",
            "lineNumber": 556
          },
          {
            "lineNumber": 557
          },
          {
            "text": "        except FileNotFoundError:",
            "lineNumber": 558
          },
          {
            "text": "            logger.debug(f\"Mod directory not found: {mod_path}\")",
            "lineNumber": 559
          },
          {
            "text": "            return False",
            "lineNumber": 560
          },
          {
            "lineNumber": 561
          },
          {
            "text": "        except OSError as e:",
            "lineNumber": 562
          },
          {
            "text": "            error_code = e.errno",
            "lineNumber": 563
          },
          {
            "lineNumber": 564
          },
          {
            "text": "            if e.errno == errno.ENOTEMPTY:",
            "lineNumber": 565
          },
          {
            "text": "                warning_text = self.tr(",
            "lineNumber": 566
          },
          {
            "text": "                    \"Mod directory was not empty. Please close all programs accessing \"",
            "lineNumber": 567
          },
          {
            "text": "                    \"files or subfolders in the directory (including your file manager) \"",
            "lineNumber": 568
          },
          {
            "text": "                    \"and try again.\"",
            "lineNumber": 569
          },
          {
            "text": "                )",
            "lineNumber": 570
          },
          {
            "text": "            else:",
            "lineNumber": 571
          },
          {
            "text": "                warning_text = self.tr(\"An OS error occurred while deleting the mod.\")",
            "lineNumber": 572
          },
          {
            "lineNumber": 573
          },
          {
            "text": "            logger.error(f\"Failed to delete mod at path: {mod_path} - {e}\")",
            "lineNumber": 574
          },
          {
            "lineNumber": 575
          },
          {
            "text": "            show_warning(",
            "lineNumber": 576
          },
          {
            "text": "                title=self.tr(\"Unable to delete mod\"),",
            "lineNumber": 577
          },
          {
            "text": "                text=warning_text,",
            "lineNumber": 578
          },
          {
            "text": "                information=self.tr(",
            "lineNumber": 579
          },
          {
            "text": "                    f\"{e.strerror or 'Unknown error'} occurred at {e.filename or mod_path} with error code {error_code}.\"",
            "lineNumber": 580
          },
          {
            "text": "                ),",
            "lineNumber": 581
          },
          {
            "text": "            )",
            "lineNumber": 582
          },
          {
            "text": "            return False",
            "lineNumber": 583
          },
          {
            "lineNumber": 584
          },
          {
            "text": "    def delete_mod_completely(self) -&gt; None:",
            "lineNumber": 585
          },
          {
            "text": "        ",
            "lineNumber": 586
          }
        ]
      },
      "score": 0.43061333894729614
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 737,
                "column": 5
              },
              "endPosition": {
                "line": 738,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "text": "def _delete_mods_and_manage_steam(self, action: str) -&gt; None:",
            "lineNumber": 737
          },
          {
            "lineNumber": 764
          },
          {
            "lineNumber": 765
          },
          {
            "text": "        if self._confirm_deletion(",
            "lineNumber": 766
          },
          {
            "text": "            self.tr(f\"Confirm Deletion and {action_capitalized}\"),",
            "lineNumber": 767
          },
          {
            "text": "            self.tr(",
            "lineNumber": 768
          },
          {
            "text": "                f\"You have selected {selected_count} mod(s) for deletion.\\n{steam_count} of these are Steam Workshop mods that will also be {action_past}.\"",
            "lineNumber": 769
          },
          {
            "text": "            ),",
            "lineNumber": 770
          },
          {
            "text": "            self.tr(",
            "lineNumber": 771
          },
          {
            "text": "                f\"\\nThis operation will:\\n• Delete the selected mod directories from your filesystem\\n• {action_capitalized} Steam Workshop mods from your Steam account\\n\\nDo you want to proceed?\"",
            "lineNumber": 772
          },
          {
            "text": "            ),",
            "lineNumber": 773
          },
          {
            "text": "        ):",
            "lineNumber": 774
          },
          {
            "text": "            # Synchronize remove_from_uuids with current selected mods before deletion",
            "lineNumber": 775
          },
          {
            "text": "            self._sync_remove_from_uuids_with_selected_mods()",
            "lineNumber": 776
          },
          {
            "lineNumber": 777
          },
          {
            "text": "            # Perform deletion and collect successfully deleted mods",
            "lineNumber": 778
          },
          {
            "text": "            result = self._iterate_mods(",
            "lineNumber": 779
          },
          {
            "text": "                self._delete_mod_directory, selected_mods, collect_for_unsubscribe=True",
            "lineNumber": 780
          },
          {
            "text": "            )",
            "lineNumber": 781
          },
          {
            "lineNumber": 782
          },
          {
            "text": "            # Process regular deletion results",
            "lineNumber": 783
          },
          {
            "text": "            self._process_deletion_result(result)",
            "lineNumber": 784
          },
          {
            "lineNumber": 785
          },
          {
            "text": "            # Handle Steam action for successfully deleted mods",
            "lineNumber": 786
          },
          {
            "text": "            self._handle_steam_action(action, result.mods_for_unsubscribe)",
            "lineNumber": 787
          },
          {
            "lineNumber": 788
          },
          {
            "text": "    def delete_mod_from_aux_db(self, path: str) -&gt; None:",
            "lineNumber": 789
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 790
          }
        ]
      },
      "score": 0.4274686574935913
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831,
            "column": 31
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 787
          },
          {
            "lineNumber": 788
          },
          {
            "text": "    def delete_mod_from_aux_db(self, path: str) -&gt; None:",
            "lineNumber": 789
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 790
          },
          {
            "text": "        Delete mod entry from the auxiliary metadata db.",
            "lineNumber": 791
          },
          {
            "lineNumber": 792
          },
          {
            "text": "        This only deletes the mod for the relevant instance.",
            "lineNumber": 793
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 794
          },
          {
            "text": "        time_limit = self.settings_controller.settings.aux_db_time_limit",
            "lineNumber": 795
          },
          {
            "text": "        if time_limit &lt; 0:",
            "lineNumber": 796
          },
          {
            "text": "            logger.debug(",
            "lineNumber": 797
          },
          {
            "text": "                \"Not deleting or setting item as outdated in Aux Metadata DB as time limit is negative.\"",
            "lineNumber": 798
          },
          {
            "text": "            )",
            "lineNumber": 799
          },
          {
            "text": "            return",
            "lineNumber": 800
          },
          {
            "lineNumber": 801
          },
          {
            "text": "        aux_metadata_controller = AuxMetadataController.get_or_create_cached_instance(",
            "lineNumber": 802
          },
          {
            "text": "            self.settings_controller.settings.aux_db_path",
            "lineNumber": 803
          },
          {
            "text": "        )",
            "lineNumber": 804
          },
          {
            "text": "        mod_path = Path(path)",
            "lineNumber": 805
          },
          {
            "text": "        with aux_metadata_controller.Session() as session:",
            "lineNumber": 806
          },
          {
            "text": "            if time_limit &gt; 0:",
            "lineNumber": 807
          },
          {
            "text": "                logger.debug(",
            "lineNumber": 808
          },
          {
            "text": "                    \"Not deleting item from Aux Metadata DB as time limit is over 0. Setting as outdated instead.\"",
            "lineNumber": 809
          },
          {
            "text": "                )",
            "lineNumber": 810
          },
          {
            "text": "                aux_metadata_controller.update(session, mod_path, outdated=True)",
            "lineNumber": 811
          },
          {
            "text": "                return",
            "lineNumber": 812
          },
          {
            "text": "            aux_metadata_controller.delete(session, mod_path)",
            "lineNumber": 813
          },
          {
            "lineNumber": 814
          },
          {
            "text": "    # Backward compatibility aliases",
            "lineNumber": 815
          },
          {
            "text": "    def delete_both(self) -&gt; None:",
            "lineNumber": 816
          },
          {
            "text": "        \"\"\"Alias for delete_mod_completely for backward compatibility.\"\"\"",
            "lineNumber": 817
          },
          {
            "text": "        self.delete_mod_completely()",
            "lineNumber": 818
          },
          {
            "lineNumber": 819
          },
          {
            "text": "    def delete_dds(self) -&gt; None:",
            "lineNumber": 820
          },
          {
            "text": "        \"\"\"Alias for delete_dds_files_only for backward compatibility.\"\"\"",
            "lineNumber": 821
          },
          {
            "text": "        self.delete_dds_files_only()",
            "lineNumber": 822
          },
          {
            "lineNumber": 823
          },
          {
            "text": "    def _dummy_translations(self) -&gt; None:",
            "lineNumber": 824
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 825
          },
          {
            "text": "        Dummy method to ensure translation strings are included for i18n tools.",
            "lineNumber": 826
          },
          {
            "text": "        Consider removing or replacing with proper translation extraction.",
            "lineNumber": 827
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 828
          },
          {
            "text": "        self.tr(\"unsubscribe\")",
            "lineNumber": 829
          },
          {
            "text": "        self.tr(\"resubscribe\")",
            "lineNumber": 830
          },
          {
            "text": "        self.tr(\"unsubscribed\")",
            "lineNumber": 831
          },
          {
            "text": "        self.tr(\"resubscribed\")",
            "lineNumber": 832,
            "isSignature": true
          }
        ]
      },
      "score": 0.4165172576904297
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 735
          },
          {
            "lineNumber": 736
          },
          {
            "text": "    def _delete_mods_and_manage_steam(self, action: str) -&gt; None:",
            "lineNumber": 737
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 738
          },
          {
            "text": "        Common method to delete mods and manage Steam Workshop subscription.",
            "lineNumber": 739
          },
          {
            "lineNumber": 740
          },
          {
            "text": "        Args:",
            "lineNumber": 741
          },
          {
            "text": "            action: \"unsubscribe\" or \"resubscribe\"",
            "lineNumber": 742
          },
          {
            "lineNumber": 743
          },
          {
            "text": "        This method handles user confirmation, deletion of selected mods,",
            "lineNumber": 744
          },
          {
            "text": "        and then calls the appropriate Steam Workshop action handler.",
            "lineNumber": 745
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 746
          },
          {
            "text": "        selected_mods = self.get_selected_mod_metadata()",
            "lineNumber": 747
          },
          {
            "lineNumber": 748
          },
          {
            "text": "        if not selected_mods:",
            "lineNumber": 749
          },
          {
            "text": "            self._show_no_mods_selected_message()",
            "lineNumber": 750
          },
          {
            "text": "            return",
            "lineNumber": 751
          },
          {
            "lineNumber": 752
          },
          {
            "text": "        # Filter mods that can be managed (have Steam Workshop IDs)",
            "lineNumber": 753
          },
          {
            "text": "        steam_mods = [",
            "lineNumber": 754
          },
          {
            "text": "            mod",
            "lineNumber": 755
          },
          {
            "text": "            for mod in selected_mods",
            "lineNumber": 756
          },
          {
            "text": "            if mod.get(\"publishedfileid\")",
            "lineNumber": 757
          },
          {
            "text": "            and isinstance(mod.get(\"publishedfileid\"), str)",
            "lineNumber": 758
          },
          {
            "text": "        ]",
            "lineNumber": 759
          },
          {
            "lineNumber": 760
          },
          {
            "text": "        selected_count = len(selected_mods)",
            "lineNumber": 761
          },
          {
            "text": "        steam_count = len(steam_mods)",
            "lineNumber": 762
          },
          {
            "text": "        action_capitalized = self.tr(action).capitalize()",
            "lineNumber": 763
          },
          {
            "text": "        action_past = self.tr(action + \"d\")",
            "lineNumber": 764
          },
          {
            "lineNumber": 765
          },
          {
            "text": "        if self._confirm_deletion(",
            "lineNumber": 766
          },
          {
            "text": "            self.tr",
            "lineNumber": 767
          }
        ]
      },
      "score": 0.4106053113937378
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 262
          },
          {
            "lineNumber": 263
          },
          {
            "text": "    def _is_official_expansion(self, mod_metadata: ModMetadata) -&gt; bool:",
            "lineNumber": 264
          },
          {
            "text": "        \"\"\"Check if the mod is an official expansion that should not be deleted.\"\"\"",
            "lineNumber": 265
          },
          {
            "text": "        return mod_metadata.get(",
            "lineNumber": 266
          },
          {
            "text": "            \"data_source\"",
            "lineNumber": 267
          },
          {
            "text": "        ) == self.EXPANSION_DATA_SOURCE and mod_metadata.get(",
            "lineNumber": 268
          },
          {
            "text": "            \"packageid\", \"\"",
            "lineNumber": 269
          },
          {
            "text": "        ).startswith(self.LUDEON_PACKAGE_PREFIX)",
            "lineNumber": 270
          },
          {
            "lineNumber": 271
          },
          {
            "text": "    def _process_deletion_result(self, result: DeletionResult) -&gt; None:",
            "lineNumber": 272
          },
          {
            "text": "        \"\"\"Process the results of a deletion operation.\"\"\"",
            "lineNumber": 273
          },
          {
            "text": "        # Purge SteamCMD metadata for deleted mods (only if auto-clear depot cache is enabled)",
            "lineNumber": 274
          },
          {
            "text": "        if result.steamcmd_purge_ids:",
            "lineNumber": 275
          },
          {
            "text": "            steamcmd_purge_mods(",
            "lineNumber": 276
          },
          {
            "text": "                metadata_manager=self.metadata_manager,",
            "lineNumber": 277
          },
          {
            "text": "                publishedfileids=result.steamcmd_purge_ids,",
            "lineNumber": 278
          },
          {
            "text": "                auto_clear_enabled=self.settings_controller.settings.instances[",
            "lineNumber": 279
          },
          {
            "text": "                    self.settings_controller.settings.current_instance",
            "lineNumber": 280
          },
          {
            "text": "                ].steamcmd_auto_clear_depot_cache,",
            "lineNumber": 281
          },
          {
            "text": "            )",
            "lineNumber": 282
          },
          {
            "lineNumber": 283
          },
          {
            "text": "        # Show success message",
            "lineNumber": 284
          },
          {
            "text": "        if result.success_count &gt; 0:",
            "lineNumber": 285
          },
          {
            "text": "            show_information(",
            "lineNumber": 286
          },
          {
            "text": "                title=self.tr(\"RimSort\"),",
            "lineNumber": 287
          },
          {
            "text": "                text=self.tr(",
            "lineNumber": 288
          },
          {
            "text": "                    f\"Successfully deleted {result.success_count} selected mods.\"",
            "lineNumber": 289
          },
          {
            "text": "                ),",
            "lineNumber": 290
          },
          {
            "text": "            )",
            "lineNumber": 291
          },
          {
            "lineNumber": 292
          },
          {
            "text": "            # Show failure message if any deletions failed",
            "lineNumber": 293
          },
          {
            "text": "            if result.failed_count &gt; 0:",
            "lineNumber": 294
          },
          {
            "text": "                show_warning(",
            "lineNumber": 295
          },
          {
            "text": "                    title=self.tr(\"Deletion Incomplete\"),",
            "lineNumber": 296
          },
          {
            "text": "                    text=self.tr(",
            "lineNumber": 297
          },
          {
            "text": "                        f\"Failed to delete {result.failed_count} mod(s). Check logs for details.\"",
            "lineNumber": 298
          },
          {
            "text": "                    ),",
            "lineNumber": 299
          },
          {
            "text": "                )",
            "lineNumber": 300
          },
          {
            "lineNumber": 301
          },
          {
            "text": "        # Call completion callback if provided",
            "lineNumber": 302
          },
          {
            "text": "        if self.completion_callback:",
            "lineNumber": 303
          },
          {
            "text": "            self.completion_callback()",
            "lineNumber": 304
          },
          {
            "lineNumber": 305
          },
          {
            "text": "    def _iterate_mods(",
            "lineNumber": 306
          },
          {
            "text": "        self,",
            "lineNumber": 307
          },
          {
            "text": "        deletion_fn: Callable[[ModMetadata], bool],",
            "lineNumber": 308
          },
          {
            "text": "        mods: list[ModMetadata],",
            "lineNumber": 309
          },
          {
            "text": "        collect_for_unsubscribe: bool = False,",
            "lineNumber": 310
          },
          {
            "text": "        update_db: bool = True,",
            "lineNumber": 311
          },
          {
            "text": "        show_progress: bool = False,",
            "lineNumber": 312
          },
          {
            "text": "    ) -&gt; DeletionResult:",
            "lineNumber": 313
          },
          {
            "text": "        ",
            "lineNumber": 314
          }
        ]
      },
      "score": 0.4080308973789215
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 466,
                "column": 5
              },
              "endPosition": {
                "line": 467,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "text": "def _handle_uuid_removal(self, mod_metadata: ModMetadata) -&gt; None:",
            "lineNumber": 466
          },
          {
            "lineNumber": 473
          },
          {
            "text": "            return",
            "lineNumber": 474
          },
          {
            "text": "        if \"uuid\" not in mod_metadata:",
            "lineNumber": 475
          },
          {
            "text": "            # Try to retrieve UUID from MetadataManager's mapper using the mod's path",
            "lineNumber": 476
          },
          {
            "text": "            mod_path = mod_metadata.get(\"path\")",
            "lineNumber": 477
          },
          {
            "text": "            if mod_path:",
            "lineNumber": 478
          },
          {
            "text": "                uuid = self.metadata_manager.mod_metadata_dir_mapper.get(str(mod_path))",
            "lineNumber": 479
          },
          {
            "text": "                if uuid:",
            "lineNumber": 480
          },
          {
            "text": "                    mod_metadata[\"uuid\"] = uuid",
            "lineNumber": 481
          },
          {
            "text": "                    logger.debug(",
            "lineNumber": 482
          },
          {
            "text": "                        f\"Retrieved UUID {uuid} for mod {mod_metadata.get('name', 'Unknown')} from path\"",
            "lineNumber": 483
          },
          {
            "text": "                    )",
            "lineNumber": 484
          },
          {
            "text": "                else:",
            "lineNumber": 485
          },
          {
            "text": "                    logger.debug(",
            "lineNumber": 486
          },
          {
            "text": "                        f\"Could not retrieve UUID for mod {mod_metadata.get('name', 'Unknown')} with path {mod_path}\"",
            "lineNumber": 487
          },
          {
            "text": "                    )",
            "lineNumber": 488
          },
          {
            "text": "                    return",
            "lineNumber": 489
          },
          {
            "text": "            else:",
            "lineNumber": 490
          },
          {
            "text": "                logger.debug(",
            "lineNumber": 491
          },
          {
            "text": "                    f\"Mod {mod_metadata.get('name', 'Unknown')} has no path, cannot retrieve UUID\"",
            "lineNumber": 492
          },
          {
            "text": "                )",
            "lineNumber": 493
          },
          {
            "text": "                return",
            "lineNumber": 494
          },
          {
            "text": "        if mod_metadata[\"uuid\"] not in self.remove_from_uuids:",
            "lineNumber": 495
          },
          {
            "text": "            logger.debug(",
            "lineNumber": 496
          },
          {
            "text": "                f\"UUID {mod_metadata['uuid']} not in remove_from_uuids list, skipping removal\"",
            "lineNumber": 497
          },
          {
            "text": "            )",
            "lineNumber": 498
          },
          {
            "text": "            return",
            "lineNumber": 499
          },
          {
            "lineNumber": 500
          },
          {
            "text": "        try:",
            "lineNumber": 501
          },
          {
            "text": "            logger.debug(f\"Emitting mod_deleted_signal for {mod_metadata['uuid']}\")",
            "lineNumber": 502
          },
          {
            "text": "            self.metadata_manager.mod_deleted_signal.emit(mod_metadata[\"uuid\"])",
            "lineNumber": 503
          },
          {
            "text": "            logger.debug(f\"Removing UUID {mod_metadata['uuid']} from tracking list\")",
            "lineNumber": 504
          },
          {
            "text": "            self.remove_from_uuids.remove(mod_metadata[\"uuid\"])",
            "lineNumber": 505
          },
          {
            "text": "        except (ValueError, AttributeError) as uuid_error:",
            "lineNumber": 506
          },
          {
            "text": "            logger.warning(",
            "lineNumber": 507
          },
          {
            "text": "                f\"Failed to remove UUID for mod {mod_metadata.get('name', 'Unknown')}: {uuid_error}\"",
            "lineNumber": 508
          },
          {
            "text": "            )",
            "lineNumber": 509
          },
          {
            "lineNumber": 510
          },
          {
            "text": "    def _track_steamcmd_mod(",
            "lineNumber": 511
          },
          {
            "text": "        self, mod_metadata: ModMetadata, result: DeletionResult",
            "lineNumber": 512
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 513
          },
          {
            "text": "        ",
            "lineNumber": 514
          }
        ]
      },
      "score": 0.40697944164276123
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "text": "def _iterate_mods(",
            "lineNumber": 306
          },
          {
            "text": "        self,",
            "lineNumber": 307
          },
          {
            "text": "        deletion_fn: Callable[[ModMetadata], bool],",
            "lineNumber": 308
          },
          {
            "text": "        mods: list[ModMetadata],",
            "lineNumber": 309
          },
          {
            "text": "        collect_for_unsubscribe: bool = False,",
            "lineNumber": 310
          },
          {
            "text": "        update_db: bool = True,",
            "lineNumber": 311
          },
          {
            "text": "        show_progress: bool = False,",
            "lineNumber": 312
          },
          {
            "text": "    ) -&gt; DeletionResult:",
            "lineNumber": 313
          },
          {
            "lineNumber": 355
          },
          {
            "text": "        return result",
            "lineNumber": 356
          },
          {
            "lineNumber": 357
          },
          {
            "text": "    def _process_single_mod_deletion(",
            "lineNumber": 358
          },
          {
            "text": "        self,",
            "lineNumber": 359
          },
          {
            "text": "        mod_metadata: ModMetadata,",
            "lineNumber": 360
          },
          {
            "text": "        deletion_fn: Callable[[ModMetadata], bool],",
            "lineNumber": 361
          },
          {
            "text": "        result: DeletionResult,",
            "lineNumber": 362
          },
          {
            "text": "        collect_for_unsubscribe: bool,",
            "lineNumber": 363
          },
          {
            "text": "        update_db: bool,",
            "lineNumber": 364
          },
          {
            "text": "    ) -&gt; bool:",
            "lineNumber": 365
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 366
          },
          {
            "text": "        Process deletion for a single mod with comprehensive error handling.",
            "lineNumber": 367
          },
          {
            "lineNumber": 368
          },
          {
            "text": "        Returns:",
            "lineNumber": 369
          },
          {
            "text": "            bool: True if deletion was successful, False otherwise",
            "lineNumber": 370
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 371
          },
          {
            "text": "        mod_name = mod_metadata.get(\"name\", \"Unknown\")",
            "lineNumber": 372
          },
          {
            "text": "        mod_path = mod_metadata.get(\"path\", \"\")",
            "lineNumber": 373
          },
          {
            "lineNumber": 374
          },
          {
            "text": "        try:",
            "lineNumber": 375
          },
          {
            "text": "            # Update database first (if requested)",
            "lineNumber": 376
          },
          {
            "text": "            if update_db and not self._update_mod_database(mod_path, mod_name):",
            "lineNumber": 377
          },
          {
            "text": "                result.failed_count += 1",
            "lineNumber": 378
          },
          {
            "text": "                return False",
            "lineNumber": 379
          },
          {
            "lineNumber": 380
          },
          {
            "text": "            # Retrieve UUID before deletion if not present",
            "lineNumber": 381
          },
          {
            "text": "            if \"uuid\" not in mod_metadata:",
            "lineNumber": 382
          },
          {
            "text": "                uuid = self.metadata_manager.mod_metadata_dir_mapper.get(mod_path)",
            "lineNumber": 383
          },
          {
            "text": "                if uuid:",
            "lineNumber": 384
          },
          {
            "text": "                    mod_metadata[\"uuid\"] = uuid",
            "lineNumber": 385
          },
          {
            "text": "                    logger.debug(",
            "lineNumber": 386
          },
          {
            "text": "                        f\"Retrieved UUID {uuid} for mod {mod_name} before deletion\"",
            "lineNumber": 387
          },
          {
            "text": "                    )",
            "lineNumber": 388
          },
          {
            "text": "                else:",
            "lineNumber": 389
          },
          {
            "text": "                    logger.warning(",
            "lineNumber": 390
          },
          {
            "text": "                        f\"Could not retrieve UUID for mod {mod_name} with path {mod_path} before deletion\"",
            "lineNumber": 391
          },
          {
            "text": "                    )",
            "lineNumber": 392
          },
          {
            "lineNumber": 393
          },
          {
            "text": "            # Perform the deletion operation",
            "lineNumber": 394
          },
          {
            "text": "            return self._execute_deletion_operation(",
            "lineNumber": 395
          },
          {
            "text": "                mod_metadata, deletion_fn, result, mod_name",
            "lineNumber": 396
          },
          {
            "text": "            )",
            "lineNumber": 397
          },
          {
            "lineNumber": 398
          },
          {
            "text": "        except Exception as general_error:",
            "lineNumber": 399
          },
          {
            "text": "            logger.error(f\"Critical error processing mod {mod_name}: {general_error}\")",
            "lineNumber": 400
          },
          {
            "text": "            result.failed_count += 1",
            "lineNumber": 401
          },
          {
            "text": "            return False",
            "lineNumber": 402
          },
          {
            "lineNumber": 403
          },
          {
            "text": "    def _update_mod_database(self, mod_path: str, mod_name: str) -&gt; bool:",
            "lineNumber": 404
          },
          {
            "text": "        \"\"\"Update the auxiliary database for a mod. Returns True if successful.\"\"\"",
            "lineNumber": 405
          }
        ]
      },
      "score": 0.39978086948394775
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 5
              },
              "endPosition": {
                "line": 65,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "text": "def __init__(",
            "lineNumber": 52
          },
          {
            "text": "        self,",
            "lineNumber": 53
          },
          {
            "text": "        settings_controller: SettingsController,",
            "lineNumber": 54
          },
          {
            "text": "        get_selected_mod_metadata: Callable[[], list[ModMetadata]],",
            "lineNumber": 55
          },
          {
            "text": "        remove_from_uuids: list[str] | None = None,",
            "lineNumber": 56
          },
          {
            "text": "        menu_title: str = \"Deletion options\",",
            "lineNumber": 57
          },
          {
            "text": "        enable_delete_mod: bool = True,",
            "lineNumber": 58
          },
          {
            "text": "        enable_delete_keep_dds: bool = True,",
            "lineNumber": 59
          },
          {
            "text": "        enable_delete_dds_only: bool = True,",
            "lineNumber": 60
          },
          {
            "text": "        enable_delete_and_unsubscribe: bool = True,",
            "lineNumber": 61
          },
          {
            "text": "        enable_delete_and_resubscribe: bool = True,",
            "lineNumber": 62
          },
          {
            "text": "        completion_callback: Callable[[], None] | None = None,",
            "lineNumber": 63
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 64
          },
          {
            "lineNumber": 91
          },
          {
            "text": "        self._refresh_actions()",
            "lineNumber": 92
          },
          {
            "lineNumber": 93
          },
          {
            "text": "    def _sync_remove_from_uuids_with_selected_mods(self) -&gt; None:",
            "lineNumber": 94
          },
          {
            "text": "        \"\"\"Synchronize remove_from_uuids list with UUIDs of currently selected mods.\"\"\"",
            "lineNumber": 95
          },
          {
            "text": "        if self.remove_from_uuids is None:",
            "lineNumber": 96
          },
          {
            "text": "            self.remove_from_uuids = []",
            "lineNumber": 97
          },
          {
            "text": "        selected_mods = self.get_selected_mod_metadata()",
            "lineNumber": 98
          },
          {
            "text": "        uuids = []",
            "lineNumber": 99
          },
          {
            "text": "        for mod in selected_mods:",
            "lineNumber": 100
          },
          {
            "text": "            uuid = mod.get(\"uuid\")",
            "lineNumber": 101
          },
          {
            "text": "            if not uuid:",
            "lineNumber": 102
          },
          {
            "text": "                mod_path = mod.get(\"path\")",
            "lineNumber": 103
          },
          {
            "text": "                if mod_path:",
            "lineNumber": 104
          },
          {
            "text": "                    uuid = self.metadata_manager.mod_metadata_dir_mapper.get(",
            "lineNumber": 105
          },
          {
            "text": "                        str(mod_path)",
            "lineNumber": 106
          },
          {
            "text": "                    )",
            "lineNumber": 107
          },
          {
            "text": "            if uuid:",
            "lineNumber": 108
          },
          {
            "text": "                uuids.append(uuid)",
            "lineNumber": 109
          },
          {
            "text": "        # Remove duplicates and update the list",
            "lineNumber": 110
          },
          {
            "text": "        self.remove_from_uuids = list(set(self.remove_from_uuids) | set(uuids))",
            "lineNumber": 111
          },
          {
            "text": "        logger.debug(f\"Synchronized remove_from_uuids: {self.remove_from_uuids}\")",
            "lineNumber": 112
          },
          {
            "lineNumber": 113
          },
          {
            "text": "    def _build_actions(",
            "lineNumber": 114
          },
          {
            "text": "        self,",
            "lineNumber": 115
          },
          {
            "text": "        enable_delete_mod: bool,",
            "lineNumber": 116
          },
          {
            "text": "        enable_delete_keep_dds: bool,",
            "lineNumber": 117
          },
          {
            "text": "        enable_delete_dds_only: bool,",
            "lineNumber": 118
          },
          {
            "text": "        enable_delete_and_unsubscribe: bool,",
            "lineNumber": 119
          },
          {
            "text": "        enable_delete_and_resubscribe: bool,",
            "lineNumber": 120
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 121
          },
          {
            "text": "        ",
            "lineNumber": 122
          }
        ]
      },
      "score": 0.3973226547241211
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 447
          },
          {
            "lineNumber": 448
          },
          {
            "text": "    def _handle_successful_deletion(",
            "lineNumber": 449
          },
          {
            "text": "        self,",
            "lineNumber": 450
          },
          {
            "text": "        mod_metadata: ModMetadata,",
            "lineNumber": 451
          },
          {
            "text": "        result: DeletionResult,",
            "lineNumber": 452
          },
          {
            "text": "        collect_for_unsubscribe: bool,",
            "lineNumber": 453
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 454
          },
          {
            "text": "        \"\"\"Handle tasks that need to be performed after successful deletion.\"\"\"",
            "lineNumber": 455
          },
          {
            "text": "        # Collect for Steam unsubscription if requested",
            "lineNumber": 456
          },
          {
            "text": "        if collect_for_unsubscribe:",
            "lineNumber": 457
          },
          {
            "text": "            result.mods_for_unsubscribe.append(mod_metadata)",
            "lineNumber": 458
          },
          {
            "lineNumber": 459
          },
          {
            "text": "        # Handle UUID removal and signal emission",
            "lineNumber": 460
          },
          {
            "text": "        self._handle_uuid_removal(mod_metadata)",
            "lineNumber": 461
          },
          {
            "lineNumber": 462
          },
          {
            "text": "        # Track SteamCMD mods for purging",
            "lineNumber": 463
          },
          {
            "text": "        self._track_steamcmd_mod(mod_metadata, result)",
            "lineNumber": 464
          },
          {
            "lineNumber": 465
          },
          {
            "text": "    def _handle_uuid_removal(self, mod_metadata: ModMetadata) -&gt; None:",
            "lineNumber": 466
          },
          {
            "text": "        \"\"\"Handle UUID removal from tracking list and emit signals.\"\"\"",
            "lineNumber": 467
          },
          {
            "text": "        logger.debug(",
            "lineNumber": 468
          },
          {
            "text": "            f\"_handle_uuid_removal called for mod: {mod_metadata.get('name', 'Unknown')}\"",
            "lineNumber": 469
          },
          {
            "text": "        )",
            "lineNumber": 470
          },
          {
            "text": "        logger.debug(f\"mod_metadata keys: {list(mod_metadata.keys())}\")",
            "lineNumber": 471
          },
          {
            "text": "        if self.remove_from_uuids is None:",
            "lineNumber": 472
          },
          {
            "text": "            logger.debug(\"remove_from_uuids is None, skipping UUID removal\")",
            "lineNumber": 473
          },
          {
            "text": "            return",
            "lineNumber": 474
          },
          {
            "text": "        if \"uuid\" not in mod_metadata:",
            "lineNumber": 475
          },
          {
            "text": "            # Try to retrieve UUID from MetadataManager's mapper using the mod's path",
            "lineNumber": 476
          }
        ]
      },
      "score": 0.39488351345062256
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 402
          },
          {
            "lineNumber": 403
          },
          {
            "text": "    def _update_mod_database(self, mod_path: str, mod_name: str) -&gt; bool:",
            "lineNumber": 404
          },
          {
            "text": "        \"\"\"Update the auxiliary database for a mod. Returns True if successful.\"\"\"",
            "lineNumber": 405
          },
          {
            "text": "        try:",
            "lineNumber": 406
          },
          {
            "text": "            self.delete_mod_from_aux_db(mod_path)",
            "lineNumber": 407
          },
          {
            "text": "            return True",
            "lineNumber": 408
          },
          {
            "text": "        except Exception as db_error:",
            "lineNumber": 409
          },
          {
            "text": "            logger.error(f\"Failed to update database for mod {mod_name}: {db_error}\")",
            "lineNumber": 410
          },
          {
            "text": "            return False",
            "lineNumber": 411
          },
          {
            "lineNumber": 412
          },
          {
            "text": "    def _execute_deletion_operation(",
            "lineNumber": 413
          },
          {
            "text": "        self,",
            "lineNumber": 414
          },
          {
            "text": "        mod_metadata: ModMetadata,",
            "lineNumber": 415
          },
          {
            "text": "        deletion_fn: Callable[[ModMetadata], bool],",
            "lineNumber": 416
          },
          {
            "text": "        result: DeletionResult,",
            "lineNumber": 417
          },
          {
            "text": "        mod_name: str,",
            "lineNumber": 418
          },
          {
            "text": "    ) -&gt; bool:",
            "lineNumber": 419
          },
          {
            "text": "        \"\"\"Execute the deletion operation with specific error handling.\"\"\"",
            "lineNumber": 420
          },
          {
            "text": "        try:",
            "lineNumber": 421
          },
          {
            "text": "            if deletion_fn(mod_metadata):",
            "lineNumber": 422
          },
          {
            "text": "                result.success_count += 1",
            "lineNumber": 423
          },
          {
            "text": "                return True",
            "lineNumber": 424
          },
          {
            "text": "            else:",
            "lineNumber": 425
          },
          {
            "text": "                result.failed_count += 1",
            "lineNumber": 426
          },
          {
            "text": "                logger.warning(f\"Deletion function returned False for mod: {mod_name}\")",
            "lineNumber": 427
          },
          {
            "text": "                return False",
            "lineNumber": 428
          },
          {
            "lineNumber": 429
          },
          {
            "text": "        except (OSError, PermissionError) as file_error:",
            "lineNumber": 430
          },
          {
            "text": "            logger.error(f\"File system error processing mod {mod_name}: {file_error}\")",
            "lineNumber": 431
          },
          {
            "text": "            result.failed_count += 1",
            "lineNumber": 432
          },
          {
            "text": "            return False",
            "lineNumber": 433
          },
          {
            "lineNumber": 434
          },
          {
            "text": "        except (ValueError, TypeError) as data_error:",
            "lineNumber": 435
          },
          {
            "text": "            logger.error(",
            "lineNumber": 436
          },
          {
            "text": "                f\"Data validation error processing mod {mod_name}: {data_error}\"",
            "lineNumber": 437
          },
          {
            "text": "            )",
            "lineNumber": 438
          },
          {
            "text": "            result.failed_count += 1",
            "lineNumber": 439
          },
          {
            "text": "            return False",
            "lineNumber": 440
          },
          {
            "lineNumber": 441
          },
          {
            "text": "        except Exception as deletion_error:",
            "lineNumber": 442
          },
          {
            "text": "            logger.error(",
            "lineNumber": 443
          },
          {
            "text": "                f\"Unexpected error during deletion of mod {mod_name}: {deletion_error}\"",
            "lineNumber": 444
          },
          {
            "text": "            )",
            "lineNumber": 445
          },
          {
            "text": "            result.failed_count += 1",
            "lineNumber": 446
          },
          {
            "text": "            return False",
            "lineNumber": 447
          },
          {
            "lineNumber": 448
          },
          {
            "text": "    def _handle_successful_deletion(",
            "lineNumber": 449
          },
          {
            "text": "        self,",
            "lineNumber": 450
          },
          {
            "text": "        mod_metadata: ModMetadata,",
            "lineNumber": 451
          },
          {
            "text": "        result: DeletionResult,",
            "lineNumber": 452
          },
          {
            "text": "        collect_for_unsubscribe: bool,",
            "lineNumber": 453
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 454
          },
          {
            "text": "        ",
            "lineNumber": 455
          }
        ]
      },
      "score": 0.3902786076068878
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 654,
                "column": 5
              },
              "endPosition": {
                "line": 657,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "text": "def _handle_steam_action(",
            "lineNumber": 654
          },
          {
            "text": "        self, action: str, deleted_mods: list[ModMetadata]",
            "lineNumber": 655
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 656
          },
          {
            "lineNumber": 686
          },
          {
            "lineNumber": 687
          },
          {
            "text": "        try:",
            "lineNumber": 688
          },
          {
            "text": "            logger.info(",
            "lineNumber": 689
          },
          {
            "text": "                f\"{action.capitalize()}ing {len(publishedfileids)} Steam Workshop mods.\"",
            "lineNumber": 690
          },
          {
            "text": "            )",
            "lineNumber": 691
          },
          {
            "lineNumber": 692
          },
          {
            "text": "            # Emit the Steam API call",
            "lineNumber": 693
          },
          {
            "text": "            EventBus().do_steamworks_api_call.emit(",
            "lineNumber": 694
          },
          {
            "text": "                [",
            "lineNumber": 695
          },
          {
            "text": "                    action,",
            "lineNumber": 696
          },
          {
            "text": "                    publishedfileids,",
            "lineNumber": 697
          },
          {
            "text": "                ]",
            "lineNumber": 698
          },
          {
            "text": "            )",
            "lineNumber": 699
          },
          {
            "lineNumber": 700
          },
          {
            "text": "            # Show success message",
            "lineNumber": 701
          },
          {
            "text": "            show_information(",
            "lineNumber": 702
          },
          {
            "text": "                title=self.tr(\"Steam {action}\").format(",
            "lineNumber": 703
          },
          {
            "text": "                    action=self.tr(action).capitalize()",
            "lineNumber": 704
          },
          {
            "text": "                ),",
            "lineNumber": 705
          },
          {
            "text": "                text=self.tr(",
            "lineNumber": 706
          },
          {
            "text": "                    \"Successfully initiated {action} from {len} Steam Workshop mod(s).\\n\"",
            "lineNumber": 707
          },
          {
            "text": "                    \"The process may take a few moments to complete.\"",
            "lineNumber": 708
          },
          {
            "text": "                ).format(",
            "lineNumber": 709
          },
          {
            "text": "                    action=self.tr(action).capitalize(),",
            "lineNumber": 710
          },
          {
            "text": "                    len=len(publishedfileids),",
            "lineNumber": 711
          },
          {
            "text": "                ),",
            "lineNumber": 712
          },
          {
            "text": "            )",
            "lineNumber": 713
          },
          {
            "lineNumber": 714
          },
          {
            "text": "            logger.info(",
            "lineNumber": 715
          },
          {
            "text": "                f\"Successfully initiated {action} for {len(publishedfileids)} mods.\"",
            "lineNumber": 716
          },
          {
            "text": "            )",
            "lineNumber": 717
          },
          {
            "lineNumber": 718
          },
          {
            "text": "        except Exception as e:",
            "lineNumber": 719
          },
          {
            "text": "            logger.error(f\"Failed to initiate Steam {action}: {e}\")",
            "lineNumber": 720
          },
          {
            "text": "            show_warning(",
            "lineNumber": 721
          },
          {
            "text": "                title=self.tr(\"{action} Error\").format(",
            "lineNumber": 722
          },
          {
            "text": "                    action=self.tr(action).capitalize()",
            "lineNumber": 723
          },
          {
            "text": "                ),",
            "lineNumber": 724
          },
          {
            "text": "                text=self.tr(",
            "lineNumber": 725
          },
          {
            "text": "                    \"An error occurred while trying to {action} from Steam Workshop mods.\"",
            "lineNumber": 726
          },
          {
            "text": "                ).format(action=self.tr(action)),",
            "lineNumber": 727
          },
          {
            "text": "                information=str(e),",
            "lineNumber": 728
          },
          {
            "text": "            )",
            "lineNumber": 729
          },
          {
            "lineNumber": 730
          },
          {
            "text": "    def delete_mod_and_resubscribe(self) -&gt; None:",
            "lineNumber": 731
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 732
          },
          {
            "text": "        Delete selected mods, and resubscribe them from Steam Workshop.",
            "lineNumber": 733
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 734
          },
          {
            "text": "        self._delete_mods_and_manage_steam(\"resubscribe\")",
            "lineNumber": 735
          },
          {
            "lineNumber": 736
          },
          {
            "text": "    def _delete_mods_and_manage_steam(self, action: str) -&gt; None:",
            "lineNumber": 737
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 738
          }
        ]
      },
      "score": 0.37497246265411377
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "text": "def _delete_dds_from_mod(self, mod_metadata: ModMetadata) -&gt; bool:",
            "lineNumber": 614
          },
          {
            "text": ",",
            "lineNumber": 621
          },
          {
            "text": "        )",
            "lineNumber": 622
          },
          {
            "lineNumber": 623
          },
          {
            "text": "    def delete_mod_keep_dds(self) -&gt; None:",
            "lineNumber": 624
          },
          {
            "text": "        \"\"\"Delete mod files but keep .dds texture files.\"\"\"",
            "lineNumber": 625
          },
          {
            "text": "        selected_count = len(self.get_selected_mod_metadata())",
            "lineNumber": 626
          },
          {
            "text": "        self._perform_deletion_operation(",
            "lineNumber": 627
          },
          {
            "text": "            confirmation_title=self.tr(\"Confirm Selective Deletion\"),",
            "lineNumber": 628
          },
          {
            "text": "            confirmation_text=self.tr(",
            "lineNumber": 629
          },
          {
            "text": "                f\"You have selected {selected_count} mod(s) for selective deletion.\"",
            "lineNumber": 630
          },
          {
            "text": "            ),",
            "lineNumber": 631
          },
          {
            "text": "            confirmation_info=self.tr(",
            "lineNumber": 632
          },
          {
            "text": "                \"\\nThis operation will delete all mod files except for .dds texture files.\\nThe .dds files will be preserved.\\n\\nDo you want to proceed?\"",
            "lineNumber": 633
          },
          {
            "text": "            ),",
            "lineNumber": 634
          },
          {
            "text": "            deletion_fn=self._delete_except_dds,",
            "lineNumber": 635
          },
          {
            "text": "        )",
            "lineNumber": 636
          },
          {
            "lineNumber": 637
          },
          {
            "text": "    def _delete_except_dds(self, mod_metadata: ModMetadata) -&gt; bool:",
            "lineNumber": 638
          },
          {
            "text": "        \"\"\"Delete all files except .dds from a specific mod.\"\"\"",
            "lineNumber": 639
          },
          {
            "text": "        mod_path = mod_metadata.get(\"path\")",
            "lineNumber": 640
          },
          {
            "text": "        if not mod_path:",
            "lineNumber": 641
          },
          {
            "text": "            return False",
            "lineNumber": 642
          },
          {
            "text": "        return delete_files_except_extension(",
            "lineNumber": 643
          },
          {
            "text": "            directory=str(mod_path),",
            "lineNumber": 644
          },
          {
            "text": "            extension=self.DDS_EXTENSION,",
            "lineNumber": 645
          },
          {
            "text": "        )",
            "lineNumber": 646
          },
          {
            "lineNumber": 647
          },
          {
            "text": "    def delete_mod_and_unsubscribe(self) -&gt; None:",
            "lineNumber": 648
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 649
          },
          {
            "text": "        Delete selected mods and unsubscribe them from Steam Workshop.",
            "lineNumber": 650
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 651
          },
          {
            "text": "        self._delete_mods_and_manage_steam(\"unsubscribe\")",
            "lineNumber": 652
          },
          {
            "lineNumber": 653
          },
          {
            "text": "    def _handle_steam_action(",
            "lineNumber": 654
          },
          {
            "text": "        self, action: str, deleted_mods: list[ModMetadata]",
            "lineNumber": 655
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 656
          },
          {
            "text": "        ",
            "lineNumber": 657
          }
        ]
      },
      "score": 0.37293729186058044
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 652
          },
          {
            "lineNumber": 653
          },
          {
            "text": "    def _handle_steam_action(",
            "lineNumber": 654
          },
          {
            "text": "        self, action: str, deleted_mods: list[ModMetadata]",
            "lineNumber": 655
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 656
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 657
          },
          {
            "text": "        Handle Steam Workshop unsubscription or resubscription for successfully deleted mods.",
            "lineNumber": 658
          },
          {
            "lineNumber": 659
          },
          {
            "text": "        Args:",
            "lineNumber": 660
          },
          {
            "text": "            action: \"unsubscribe\" or \"resubscribe\"",
            "lineNumber": 661
          },
          {
            "text": "            deleted_mods: List of successfully deleted mod metadata",
            "lineNumber": 662
          },
          {
            "lineNumber": 663
          },
          {
            "text": "        This method extracts valid Steam Workshop IDs from the deleted mods,",
            "lineNumber": 664
          },
          {
            "text": "        converts them to integers, and emits the appropriate Steam API call",
            "lineNumber": 665
          },
          {
            "text": "        via the EventBus. It also handles logging and user notifications",
            "lineNumber": 666
          },
          {
            "text": "        for success or failure of the operation.",
            "lineNumber": 667
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 668
          },
          {
            "text": "        # Extract valid Steam Workshop IDs and convert to integers",
            "lineNumber": 669
          },
          {
            "text": "        publishedfileids = []",
            "lineNumber": 670
          },
          {
            "text": "        for mod in deleted_mods:",
            "lineNumber": 671
          },
          {
            "text": "            pfid = mod.get(\"publishedfileid\")",
            "lineNumber": 672
          },
          {
            "text": "            if pfid and isinstance(pfid, str):",
            "lineNumber": 673
          },
          {
            "text": "                try:",
            "lineNumber": 674
          },
          {
            "text": "                    # Convert string to integer as required by Steam API",
            "lineNumber": 675
          },
          {
            "text": "                    publishedfileids.append(int(pfid))",
            "lineNumber": 676
          },
          {
            "text": "                except ValueError:",
            "lineNumber": 677
          },
          {
            "text": "                    logger.debug(",
            "lineNumber": 678
          },
          {
            "text": "                        f\"Invalid publishedfileid format: {pfid} for mod {mod.get('name', 'Unknown')}\"",
            "lineNumber": 679
          },
          {
            "text": "                    )",
            "lineNumber": 680
          },
          {
            "text": "                    # Continue processing other mods even if one ID is invalid",
            "lineNumber": 681
          },
          {
            "text": "                    continue",
            "lineNumber": 682
          },
          {
            "lineNumber": 683
          },
          {
            "text": "        if not publishedfileids:",
            "lineNumber": 684
          },
          {
            "text": "            logger.info(f\"No Steam Workshop mods to {action}.\")",
            "lineNumber": 685
          },
          {
            "text": "            return",
            "lineNumber": 686
          },
          {
            "lineNumber": 687
          },
          {
            "text": "        try:",
            "lineNumber": 688
          },
          {
            "text": "            logger.info(",
            "lineNumber": 689
          },
          {
            "text": "                f\"{action.capitalize()}",
            "lineNumber": 690
          }
        ]
      },
      "score": 0.369280606508255
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\mods_panel.py",
        "range": {
          "startPosition": {
            "line": 782
          },
          "endPosition": {
            "line": 3126
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 783,
                "column": 1
              },
              "endPosition": {
                "line": 784,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 1013,
                "column": 5
              },
              "endPosition": {
                "line": 1016,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModListWidget(QListWidget):",
            "lineNumber": 783,
            "isSignature": true
          },
          {
            "text": "def eventFilter(self, object: QObject, event: QEvent) -&gt; bool:",
            "lineNumber": 1205
          },
          {
            "lineNumber": 1976
          },
          {
            "text": "                if action == change_mod_color_action:",
            "lineNumber": 1977
          },
          {
            "text": "                    color_dlg = QColorDialog(",
            "lineNumber": 1978
          },
          {
            "text": "                        options=QColorDialog.ColorDialogOption.DontUseNativeDialog",
            "lineNumber": 1979
          },
          {
            "text": "                    )",
            "lineNumber": 1980
          },
          {
            "text": "                    self.SetUserCustomColors(color_dlg)",
            "lineNumber": 1981
          },
          {
            "text": "                    new_color = color_dlg.getColor()",
            "lineNumber": 1982
          },
          {
            "text": "                    self.SaveUserCustomColors(color_dlg)",
            "lineNumber": 1983
          },
          {
            "text": "                    invalid_color = not new_color.isValid()",
            "lineNumber": 1984
          },
          {
            "text": "                if action in self.deletion_sub_menu.actions():",
            "lineNumber": 1985
          },
          {
            "text": "                    # Deletion menu handles whatever action it was, exit now",
            "lineNumber": 1986
          },
          {
            "text": "                    return True",
            "lineNumber": 1987
          },
          {
            "text": "                # Execute action for each selected mod",
            "lineNumber": 1988
          },
          {
            "text": "                for item_idx, source_item in enumerate(selected_items):",
            "lineNumber": 1989
          },
          {
            "text": "                    if type(source_item) is CustomListWidgetItem:",
            "lineNumber": 1990
          },
          {
            "text": "                        item_data = source_item.data(Qt.ItemDataRole.UserRole)",
            "lineNumber": 1991
          },
          {
            "text": "                        uuid = all_selected_uuids[item_idx]",
            "lineNumber": 1992
          }
        ]
      },
      "score": 0.3625129461288452
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\deletion_menu.py",
        "range": {
          "startPosition": {
            "line": 37
          },
          "endPosition": {
            "line": 831
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 38,
                "column": 1
              },
              "endPosition": {
                "line": 39,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModDeletionMenu(QMenu):",
            "lineNumber": 38,
            "isSignature": true
          },
          {
            "lineNumber": 509
          },
          {
            "lineNumber": 510
          },
          {
            "text": "    def _track_steamcmd_mod(",
            "lineNumber": 511
          },
          {
            "text": "        self, mod_metadata: ModMetadata, result: DeletionResult",
            "lineNumber": 512
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 513
          },
          {
            "text": "        \"\"\"Track SteamCMD mods for metadata purging.\"\"\"",
            "lineNumber": 514
          },
          {
            "text": "        if mod_metadata.get(\"steamcmd\") and \"publishedfileid\" in mod_metadata:",
            "lineNumber": 515
          },
          {
            "text": "            result.steamcmd_purge_ids.add(mod_metadata[\"publishedfileid\"])",
            "lineNumber": 516
          },
          {
            "lineNumber": 517
          },
          {
            "text": "    def _log_progress_if_enabled(",
            "lineNumber": 518
          },
          {
            "text": "        self, processed_count: int, total_mods: int, show_progress: bool",
            "lineNumber": 519
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 520
          },
          {
            "text": "        \"\"\"Log progress if progress tracking is enabled.\"\"\"",
            "lineNumber": 521
          },
          {
            "text": "        if show_progress and total_mods &gt; 0:",
            "lineNumber": 522
          },
          {
            "text": "            progress_percentage = (processed_count / total_mods) * 100",
            "lineNumber": 523
          },
          {
            "text": "            logger.info(",
            "lineNumber": 524
          },
          {
            "text": "                f\"Deletion progress: {processed_count}/{total_mods} mods processed ({progress_percentage:.1f}%)\"",
            "lineNumber": 525
          },
          {
            "text": "            )",
            "lineNumber": 526
          },
          {
            "lineNumber": 527
          },
          {
            "text": "    def _log_deletion_summary(self, result: DeletionResult) -&gt; None:",
            "lineNumber": 528
          },
          {
            "text": "        \"\"\"Log the final summary of the deletion operation.\"\"\"",
            "lineNumber": 529
          },
          {
            "text": "        total_processed = result.success_count + result.failed_count",
            "lineNumber": 530
          },
          {
            "text": "        if total_processed &gt; 0:",
            "lineNumber": 531
          },
          {
            "text": "            logger.info(",
            "lineNumber": 532
          },
          {
            "text": "                f\"Deletion operation completed: {result.success_count} successful, {result.failed_count} failed\"",
            "lineNumber": 533
          },
          {
            "text": "            )",
            "lineNumber": 534
          },
          {
            "lineNumber": 535
          },
          {
            "text": "    def _delete_mod_directory(self, mod_metadata: ModMetadata) -&gt; bool:",
            "lineNumber": 536
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 537
          }
        ]
      },
      "score": 0.34069085121154785
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\mods_panel.py",
        "range": {
          "startPosition": {
            "line": 782
          },
          "endPosition": {
            "line": 3126
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 783,
                "column": 1
              },
              "endPosition": {
                "line": 784,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 1013,
                "column": 5
              },
              "endPosition": {
                "line": 1016,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModListWidget(QListWidget):",
            "lineNumber": 783,
            "isSignature": true
          },
          {
            "text": "def eventFilter(self, object: QObject, event: QEvent) -&gt; bool:",
            "lineNumber": 1205
          },
          {
            "text": "(find_translation_action)",
            "lineNumber": 1595
          },
          {
            "text": "            if toggle_warning_action:",
            "lineNumber": 1596
          },
          {
            "text": "                context_menu.addAction(toggle_warning_action)",
            "lineNumber": 1597
          },
          {
            "lineNumber": 1598
          },
          {
            "text": "            context_menu.addMenu(self.deletion_sub_menu)",
            "lineNumber": 1599
          },
          {
            "text": "            context_menu.addSeparator()",
            "lineNumber": 1600
          },
          {
            "text": "            if (",
            "lineNumber": 1601
          },
          {
            "text": "                copy_packageid_to_clipboard_action",
            "lineNumber": 1602
          },
          {
            "text": "                or copy_url_to_clipboard_action",
            "lineNumber": 1603
          },
          {
            "text": "                or edit_mod_rules_action",
            "lineNumber": 1604
          },
          {
            "text": "                or re_git_action",
            "lineNumber": 1605
          },
          {
            "text": "            ):",
            "lineNumber": 1606
          },
          {
            "text": "                misc_options_menu = QMenu(title=self.tr(\"Miscellaneous options\"))",
            "lineNumber": 1607
          },
          {
            "text": "                if copy_packageid_to_clipboard_action:",
            "lineNumber": 1608
          },
          {
            "text": "                    clipboard_options_menu = QMenu(title=self.tr(\"Clipboard options\"))",
            "lineNumber": 1609
          },
          {
            "text": "                    clipboard_options_menu.addAction(copy_packageid_to_clipboard_action)",
            "lineNumber": 1610
          },
          {
            "text": "                    if copy_url_to_clipboard_action:",
            "lineNumber": 1611
          },
          {
            "text": "                        clipboard_options_menu.addAction(copy_url_to_clipboard_action)",
            "lineNumber": 1612
          },
          {
            "text": "                    misc_options_menu.addMenu(clipboard_options_menu)",
            "lineNumber": 1613
          },
          {
            "text": "                if edit_mod_rules_action:",
            "lineNumber": 1614
          },
          {
            "text": "                    misc_options_menu.addAction(edit_mod_rules_action)",
            "lineNumber": 1615
          },
          {
            "text": "                if re_git_action:",
            "lineNumber": 1616
          },
          {
            "text": "                    misc_options_menu.addAction(re_git_action)",
            "lineNumber": 1617
          },
          {
            "text": "                context_menu.addMenu(misc_options_menu)",
            "lineNumber": 1618
          },
          {
            "text": "            if (",
            "lineNumber": 1619
          },
          {
            "text": "                convert_local_steamcmd_action",
            "lineNumber": 1620
          }
        ]
      },
      "score": 0.33843091130256653
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\mods_panel.py",
        "range": {
          "startPosition": {
            "line": 782
          },
          "endPosition": {
            "line": 3126
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 783,
                "column": 1
              },
              "endPosition": {
                "line": 784,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 814,
                "column": 5
              },
              "endPosition": {
                "line": 815,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class ModListWidget(QListWidget):",
            "lineNumber": 783,
            "isSignature": true
          },
          {
            "text": "def __init__(self, list_type: str, settings_controller: SettingsController) -&gt; None:",
            "lineNumber": 814
          },
          {
            "lineNumber": 861
          },
          {
            "lineNumber": 862
          },
          {
            "text": "        # Allow inserting custom list items",
            "lineNumber": 863
          },
          {
            "text": "        self.model().rowsInserted.connect(self.handle_rows_inserted, Qt.ConnectionType.QueuedConnection)",
            "lineNumber": 864
          },
          {
            "lineNumber": 865
          },
          {
            "text": "        # Handle removing items to update count",
            "lineNumber": 866
          },
          {
            "text": "        self.model().rowsAboutToBeRemoved.connect(self.handle_rows_removed, Qt.ConnectionType.QueuedConnection)",
            "lineNumber": 867
          },
          {
            "lineNumber": 868
          },
          {
            "text": "        # Lazy load ModListItemInner",
            "lineNumber": 869
          },
          {
            "text": "        self.verticalScrollBar().valueChanged.connect(self.check_widgets_visible)",
            "lineNumber": 870
          },
          {
            "lineNumber": 871
          },
          {
            "text": "        # This set is used to keep track of mods that have been loaded",
            "lineNumber": 872
          },
          {
            "text": "        # into widgets. Used for an optimization strategy for &#96;handle_rows_inserted&#96;",
            "lineNumber": 873
          },
          {
            "text": "        self.uuids: list[str] = []",
            "lineNumber": 874
          },
          {
            "text": "        self.ignore_warning_list: list[str] = []",
            "lineNumber": 875
          },
          {
            "text": "        # Cache of latest save package ids to check new mods",
            "lineNumber": 876
          },
          {
            "text": "        self._latest_save_package_ids: set[str] | None = None",
            "lineNumber": 877
          },
          {
            "text": "        ",
            "lineNumber": 878
          },
          {
            "text": "        # Translation status",
            "lineNumber": 879
          },
          {
            "text": "        self.show_translation_status: bool = False",
            "lineNumber": 880
          },
          {
            "text": "        self.translation_lookup: set[str] = set()",
            "lineNumber": 881
          },
          {
            "lineNumber": 882
          },
          {
            "text": "        self.deletion_sub_menu = ModDeletionMenu(",
            "lineNumber": 883
          },
          {
            "text": "            self.settings_controller,",
            "lineNumber": 884
          },
          {
            "text": "            self._get_selected_metadata,",
            "lineNumber": 885
          },
          {
            "text": "            self.uuids,",
            "lineNumber": 886
          },
          {
            "text": "        )  # TODO: should we enable items conditionally? For now use all",
            "lineNumber": 887
          },
          {
            "text": "        logger.debug(\"Finished ModListW&#96;idget initialization\")",
            "lineNumber": 888
          },
          {
            "lineNumber": 889
          },
          {
            "text": "    def on_selection_changed(",
            "lineNumber": 890
          },
          {
            "text": "        self, selected: QItemSelection, deselected: QItemSelection",
            "lineNumber": 891
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 892
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 893
          },
          {
            "text": "        Used to indicate when the custom widget is selected/not selected.",
            "lineNumber": 894
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 895
          },
          {
            "text": "        for index in selected.indexes():",
            "lineNumber": 896
          },
          {
            "text": "            item = self.item(index.row())",
            "lineNumber": 897
          },
          {
            "text": "            widget = self.itemWidget(item)",
            "lineNumber": 898
          },
          {
            "text": "            if widget:",
            "lineNumber": 899
          },
          {
            "text": "                widget.set_selected(True)  # type: ignore",
            "lineNumber": 900
          },
          {
            "lineNumber": 901
          },
          {
            "text": "        for index in deselected.indexes():",
            "lineNumber": 902
          },
          {
            "text": "            item = self.item(index.row())",
            "lineNumber": 903
          },
          {
            "text": "            widget = self.itemWidget(item)",
            "lineNumber": 904
          },
          {
            "text": "            if widget:",
            "lineNumber": 905
          },
          {
            "text": "                widget.set_selected(False)  # type: ignore",
            "lineNumber": 906
          },
          {
            "lineNumber": 907
          },
          {
            "text": "    def item(self, row: int) -&gt; CustomListWidgetItem:",
            "lineNumber": 908
          },
          {
            "text": "        \"\"\"",
            "lineNumber": 909
          }
        ]
      },
      "score": 0.3363198935985565
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\app\\views\\menu_bar.py",
        "range": {
          "startPosition": {
            "line": 14
          },
          "endPosition": {
            "line": 409
          }
        },
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 15,
                "column": 1
              },
              "endPosition": {
                "line": 16,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 16,
                "column": 5
              },
              "endPosition": {
                "line": 19,
                "column": 9
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "class MenuBar(QObject):",
            "lineNumber": 15,
            "isSignature": true
          },
          {
            "text": "def __init__(",
            "lineNumber": 16
          },
          {
            "text": "        self, menu_bar: QMenuBar, settings_controller: SettingsController",
            "lineNumber": 17
          },
          {
            "text": "    ) -&gt; None:",
            "lineNumber": 18
          },
          {
            "lineNumber": 51
          },
          {
            "text": "        self.open_local_mods_directory_action: QAction",
            "lineNumber": 52
          },
          {
            "text": "        self.open_steam_mods_directory_action: QAction",
            "lineNumber": 53
          },
          {
            "text": "        self.cut_action: QAction",
            "lineNumber": 54
          },
          {
            "text": "        self.copy_action: QAction",
            "lineNumber": 55
          },
          {
            "text": "        self.paste_action: QAction",
            "lineNumber": 56
          },
          {
            "text": "        self.rule_editor_action: QAction",
            "lineNumber": 57
          },
          {
            "text": "        self.ignore_json_editor_action: QAction",
            "lineNumber": 58
          },
          {
            "text": "        self.reset_all_warnings_action: QAction",
            "lineNumber": 59
          },
          {
            "text": "        self.reset_all_mod_colors_action: QAction",
            "lineNumber": 60
          },
          {
            "text": "        self.add_git_mod_action: QAction",
            "lineNumber": 61
          },
          {
            "text": "        self.add_zip_mod_action: QAction",
            "lineNumber": 62
          },
          {
            "text": "        self.browse_workshop_action: QAction",
            "lineNumber": 63
          },
          {
            "text": "        self.update_workshop_mods_action: QAction",
            "lineNumber": 64
          },
          {
            "text": "        self.steam_verify_game_files_action: QAction",
            "lineNumber": 65
          },
          {
            "text": "        self.backup_instance_action: QAction",
            "lineNumber": 66
          },
          {
            "text": "        self.restore_instance_action: QAction",
            "lineNumber": 67
          },
          {
            "text": "        self.clone_instance_action: QAction",
            "lineNumber": 68
          },
          {
            "text": "        self.create_instance_action: QAction",
            "lineNumber": 69
          },
          {
            "text": "        self.delete_instance_action: QAction",
            "lineNumber": 70
          },
          {
            "text": "        self.optimize_textures_action: QAction",
            "lineNumber": 71
          },
          {
            "text": "        self.delete_dds_textures_action: QAction",
            "lineNumber": 72
          },
          {
            "text": "        self.wiki_action: QAction",
            "lineNumber": 73
          },
          {
            "text": "        self.github_action: QAction",
            "lineNumber": 74
          },
          {
            "text": "        self.show_translation_status_action: QAction",
            "lineNumber": 75
          },
          {
            "text": "        self.auto_add_translations_action: QAction",
            "lineNumber": 76
          },
          {
            "text": "        self.check_for_updates_action: QAction | None = None",
            "lineNumber": 77
          },
          {
            "text": "        self.check_for_updates_on_startup_action: QAction | None = None",
            "lineNumber": 78
          },
          {
            "lineNumber": 79
          },
          {
            "text": "        self.import_submenu: QMenu",
            "lineNumber": 80
          },
          {
            "text": "        self.export_submenu: QMenu",
            "lineNumber": 81
          },
          {
            "text": "        self.upload_submenu: QMenu",
            "lineNumber": 82
          },
          {
            "text": "        self.default_open_logs_submenu: QMenu",
            "lineNumber": 83
          },
          {
            "text": "        self.shortcuts_submenu: QMenu",
            "lineNumber": 84
          },
          {
            "text": "        self.instances_submenu: QMenu",
            "lineNumber": 85
          },
          {
            "lineNumber": 86
          },
          {
            "text": "        self._create_menu_bar()",
            "lineNumber": 87
          },
          {
            "lineNumber": 88
          },
          {
            "text": "    def _add_action(",
            "lineNumber": 89
          },
          {
            "text": "        self,",
            "lineNumber": 90
          },
          {
            "text": "        menu: QMenu,",
            "lineNumber": 91
          },
          {
            "text": "        title: str,",
            "lineNumber": 92
          },
          {
            "text": "        shortcut: str | None = None,",
            "lineNumber": 93
          },
          {
            "text": "        checkable: bool = False,",
            "lineNumber": 94
          },
          {
            "text": "        role: QAction.MenuRole | None = None,",
            "lineNumber": 95
          },
          {
            "text": "    ) -&gt; QAction:",
            "lineNumber": 96
          },
          {
            "text": "        ",
            "lineNumber": 97
          }
        ]
      },
      "score": 0.3097306489944458
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


Checking where the deletion submenu is initialized:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: d:\DEV_Rimsort\RimSort\app\views\mods_panel.py</summary>

</details>
</tool-use>

---



---


## Context Menu Implementation Summary

### 1. Context Menu Creation (Lines 1215-1658)

The context menu is handled in the `eventFilter` method of `ModListWidget`. It intercepts right-click events (`QEvent.Type.ContextMenu`) and builds a dynamic menu based on the selected mod(s).

**Entry Point:**
```python
# Lines 1215-1227: Event filter intercepts right-click
if event.type() == QEvent.Type.ContextMenu and object is self:
    pos = QCursor.pos()
    pos_local = self.mapFromGlobal(pos)
    item = self.itemAt(pos_local)
    if not isinstance(item, CustomListWidgetItem):
        return super().eventFilter(object, event)
    
    logger.info("USER ACTION: Open right-click mod_list_item contextMenu")
```

**Menu Creation:**
```python
# Line 1257: Create the context menu
context_menu = QMenu()
```

### 2. Available Context Menu Actions

Actions are conditionally created based on mod metadata and selection count:

#### **Single Item Actions (Lines 1301-1454):**
- **Open folder** (Lines 1312-1313)
- **Open folder in text editor** (Lines 1315-1319) - Only if text editor is configured
- **Change mod color** (Lines 1321-1322)
- **Reset mod color** (Lines 1323-1324)
- **Open URL in browser** (Lines 1327-1328) - If mod has URL
- **Open mod in Steam** (Lines 1340-1341) - If Steam integration enabled and mod has steam_uri
- **Find translations** (Lines 1452-1454) - Only for single selection
- **Toggle warning** (Lines 1445-1450)
- **Copy packageId to clipboard** (Lines 1437-1440)
- **Copy URL to clipboard** (Lines 1329-1332) - If mod has URL
- **Edit mod with Rule Editor** (Lines 1442-1443) - Only for single selection

#### **Workshop/SteamCMD Conversion Actions (Lines 1343-1415):**
- **Convert local mod to SteamCMD** (Lines 1364-1367) - If local mod has publishedfileid
- **Convert SteamCMD mod to local** (Lines 1372-1375) - If mod is SteamCMD
- **Re-download mod with SteamCMD** (Lines 1377-1380) - If mod is SteamCMD
- **Update mod with git** (Lines 1386-1387) - If local mod has git_repo
- **Convert Steam mod to local** (Lines 1398-1401) - If mod is Workshop
- **Re-subscribe mod with Steam** (Lines 1407-1410) - If Workshop + Steam integration
- **Unsubscribe mod with Steam** (Lines 1412-1415) - If Workshop + Steam integration
- **Add mod to SteamDB blacklist** (Lines 1432-1435) - If mod has publishedfileid
- **Remove mod from SteamDB blacklist** (Lines 1426-1429) - If mod is blacklisted

#### **Multiple Item Actions (Lines 1456-1579):**
Similar actions but with pluralized text (e.g., "Open folder(s)", "Change mod colors")

### 3. Menu Structure Assembly (Lines 1582-1656)

Actions are added to the menu in this order:

```python
# Lines 1582-1597: Main actions
if open_folder_action:
    context_menu.addAction(open_folder_action)
if open_folder_text_editor_action:
    context_menu.addAction(open_folder_text_editor_action)
if change_mod_color_action:
    context_menu.addAction(change_mod_color_action)
if reset_mod_color_action:
    context_menu.addAction(reset_mod_color_action)
if open_url_browser_action:
    context_menu.addAction(open_url_browser_action)
if open_mod_steam_action:
    context_menu.addAction(open_mod_steam_action)
if find_translation_action:
    context_menu.addAction(find_translation_action)
if toggle_warning_action:
    context_menu.addAction(toggle_warning_action)

# Line 1599: Deletion submenu
context_menu.addMenu(self.deletion_sub_menu)
context_menu.addSeparator()

# Lines 1601-1618: Miscellaneous options submenu
misc_options_menu = QMenu(title=self.tr("Miscellaneous options"))
  - Clipboard options submenu
    - Copy packageId to clipboard
    - Copy URL to clipboard
  - Edit mod with Rule Editor
  - Update mod(s) with git

# Lines 1619-1656: Workshop mods options submenu
workshop_actions_menu = QMenu(title=self.tr("Workshop mods options"))
  - Convert local mod(s) to SteamCMD
  - Convert SteamCMD mod(s) to local
  - Convert Steam mod(s) to local
  - Re-download mod(s) with SteamCMD
  - Re-subscribe mod(s) with Steam
  - Unsubscribe mod(s) with Steam
  - [Separator]
  - Add mod to SteamDB blacklist
  - Remove mod from SteamDB blacklist
```

### 4. Action Handling (Lines 1658-2117)

No signal connections. Actions are handled via direct comparison after `context_menu.exec_()`:

```python
# Line 1658: Execute menu and get selected action
action = context_menu.exec_(self.mapToGlobal(pos_local))

# Lines 1659-2117: Handle actions with if/elif chain
if action:
    if action == re_git_action:
        # Handle git update (Lines 1660-1674)
    elif action == convert_local_steamcmd_action:
        # Handle conversion (Lines 1675-1706)
    elif action == convert_steamcmd_local_action:
        # Handle conversion (Lines 1707-1743)
    elif action == re_steamcmd_action:
        # Handle SteamCMD re-download (Lines 1744-1797)
    elif action == convert_workshop_local_action:
        # Handle conversion (Lines 1798-1852)
    elif action == re_steam_action:
        # Handle Steam resubscribe (Lines 1853-1881)
    elif action == unsubscribe_mod_steam_action:
        # Handle unsubscribe (Lines 1882-1905)
    elif action == add_to_steamdb_blacklist_action:
        # Handle blacklist add (Lines 1906-1943)
    elif action == remove_from_steamdb_blacklist_acti

---

